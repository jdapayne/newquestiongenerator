!function(){"use strict";var t=function(t){for(var e in this.input=null,this.inputDisplay=null,this.slider=null,this.sliderWidth=0,this.sliderLeft=0,this.pointerWidth=0,this.pointerR=null,this.pointerL=null,this.activePointer=null,this.selected=null,this.scale=null,this.step=0,this.tipL=null,this.tipR=null,this.timeout=null,this.valRange=!1,this.values={start:null,end:null},this.conf={target:null,values:null,set:null,range:!1,width:null,scale:!0,labels:!0,tooltip:!0,step:null,disabled:!1,onChange:null},this.cls={container:"rs-container",background:"rs-bg",selected:"rs-selected",pointer:"rs-pointer",scale:"rs-scale",noscale:"rs-noscale",tip:"rs-tooltip"},this.conf)Object.prototype.hasOwnProperty.call(t,e)&&(this.conf[e]=t[e]);this.init()};t.prototype.init=function(){return"object"==typeof this.conf.target?this.input=this.conf.target:this.input=document.getElementById(this.conf.target.replace("#","")),this.input?(this.inputDisplay=getComputedStyle(this.input,null).display,this.input.style.display="none",this.valRange=!(this.conf.values instanceof Array),!this.valRange||Object.prototype.hasOwnProperty.call(this.conf.values,"min")&&Object.prototype.hasOwnProperty.call(this.conf.values,"max")?this.createSlider():console.log("Missing min or max value...")):console.log("Cannot find target element...")},t.prototype.createSlider=function(){return this.slider=e("div",this.cls.container),this.slider.innerHTML='<div class="rs-bg"></div>',this.selected=e("div",this.cls.selected),this.pointerL=e("div",this.cls.pointer,["dir","left"]),this.scale=e("div",this.cls.scale),this.conf.tooltip&&(this.tipL=e("div",this.cls.tip),this.tipR=e("div",this.cls.tip),this.pointerL.appendChild(this.tipL)),this.slider.appendChild(this.selected),this.slider.appendChild(this.scale),this.slider.appendChild(this.pointerL),this.conf.range&&(this.pointerR=e("div",this.cls.pointer,["dir","right"]),this.conf.tooltip&&this.pointerR.appendChild(this.tipR),this.slider.appendChild(this.pointerR)),this.input.parentNode.insertBefore(this.slider,this.input.nextSibling),this.conf.width&&(this.slider.style.width=parseInt(this.conf.width)+"px"),this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.pointerWidth=this.pointerL.clientWidth,this.conf.scale||this.slider.classList.add(this.cls.noscale),this.setInitialValues()},t.prototype.setInitialValues=function(){if(this.disabled(this.conf.disabled),this.valRange&&(this.conf.values=i(this.conf)),this.values.start=0,this.values.end=this.conf.range?this.conf.values.length-1:0,this.conf.set&&this.conf.set.length&&n(this.conf)){var t=this.conf.set;this.conf.range?(this.values.start=this.conf.values.indexOf(t[0]),this.values.end=this.conf.set[1]?this.conf.values.indexOf(t[1]):null):this.values.end=this.conf.values.indexOf(t[0])}return this.createScale()},t.prototype.createScale=function(t){this.step=this.sliderWidth/(this.conf.values.length-1);for(var s=0,i=this.conf.values.length;s<i;s++){var n=e("span"),o=e("ins");n.appendChild(o),this.scale.appendChild(n),n.style.width=s===i-1?0:this.step+"px",this.conf.labels?o.innerHTML=this.conf.values[s]:0!==s&&s!==i-1||(o.innerHTML=this.conf.values[s]),o.style.marginLeft=o.clientWidth/2*-1+"px"}return this.addEvents()},t.prototype.updateScale=function(){this.step=this.sliderWidth/(this.conf.values.length-1);for(var t=this.slider.querySelectorAll("span"),e=0,s=t.length;e<s-1;e++)t[e].style.width=this.step+"px";return this.setValues()},t.prototype.addEvents=function(){var t=this.slider.querySelectorAll("."+this.cls.pointer),e=this.slider.querySelectorAll("span");s(document,"mousemove touchmove",this.move.bind(this)),s(document,"mouseup touchend touchcancel",this.drop.bind(this));for(let e=0,i=t.length;e<i;e++)s(t[e],"mousedown touchstart",this.drag.bind(this));for(let t=0,i=e.length;t<i;t++)s(e[t],"click",this.onClickPiece.bind(this));return window.addEventListener("resize",this.onResize.bind(this)),this.setValues()},t.prototype.drag=function(t){if(t.preventDefault(),!this.conf.disabled){var e=t.target.getAttribute("data-dir");return"left"===e&&(this.activePointer=this.pointerL),"right"===e&&(this.activePointer=this.pointerR),this.slider.classList.add("sliding")}},t.prototype.move=function(t){if(this.activePointer&&!this.conf.disabled){var e=("touchmove"===t.type?t.touches[0].clientX:t.pageX)-this.sliderLeft-this.pointerWidth/2;return(e=Math.round(e/this.step))<=0&&(e=0),e>this.conf.values.length-1&&(e=this.conf.values.length-1),this.conf.range?(this.activePointer===this.pointerL&&(this.values.start=e),this.activePointer===this.pointerR&&(this.values.end=e)):this.values.end=e,this.setValues()}},t.prototype.drop=function(){this.activePointer=null},t.prototype.setValues=function(t,e){var s=this.conf.range?"start":"end";return t&&this.conf.values.indexOf(t)>-1&&(this.values[s]=this.conf.values.indexOf(t)),e&&this.conf.values.indexOf(e)>-1&&(this.values.end=this.conf.values.indexOf(e)),this.conf.range&&this.values.start>this.values.end&&(this.values.start=this.values.end),this.pointerL.style.left=this.values[s]*this.step-this.pointerWidth/2+"px",this.conf.range?(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.start],this.tipR.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.start]+","+this.conf.values[this.values.end],this.pointerR.style.left=this.values.end*this.step-this.pointerWidth/2+"px"):(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.end]),this.values.end>this.conf.values.length-1&&(this.values.end=this.conf.values.length-1),this.values.start<0&&(this.values.start=0),this.selected.style.width=(this.values.end-this.values.start)*this.step+"px",this.selected.style.left=this.values.start*this.step+"px",this.onChange()},t.prototype.onClickPiece=function(t){if(!this.conf.disabled){var e=Math.round((t.clientX-this.sliderLeft)/this.step);return e>this.conf.values.length-1&&(e=this.conf.values.length-1),e<0&&(e=0),this.conf.range&&e-this.values.start<=this.values.end-e?this.values.start=e:this.values.end=e,this.slider.classList.remove("sliding"),this.setValues()}},t.prototype.onChange=function(){var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){if(t.conf.onChange&&"function"==typeof t.conf.onChange)return t.conf.onChange(t.input.value)}),500)},t.prototype.onResize=function(){return this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.updateScale()},t.prototype.disabled=function(t){this.conf.disabled=t,this.slider.classList[t?"add":"remove"]("disabled")},t.prototype.getValue=function(){return[this.conf.values[this.values.start],this.conf.values[this.values.end]]},t.prototype.getValueL=function(){return this.conf.values[this.values.start]},t.prototype.getValueR=function(){return this.conf.values[this.values.end]},t.prototype.destroy=function(){this.input.style.display=this.inputDisplay,this.slider.remove()};var e=function(t,e,s){var i=document.createElement(t);return e&&(i.className=e),s&&2===s.length&&i.setAttribute("data-"+s[0],s[1]),i},s=function(t,e,s){for(var i=e.split(" "),n=0,o=i.length;n<o;n++)t.addEventListener(i[n],s)},i=function(t){var e=[],s=t.values.max-t.values.min;if(!t.step)return console.log("No step defined..."),[t.values.min,t.values.max];for(var i=0,n=s/t.step;i<n;i++)e.push(t.values.min+i*t.step);return e.indexOf(t.values.max)<0&&e.push(t.values.max),e},n=function(t){return!t.set||t.set.length<1||t.values.indexOf(t.set[0])<0?null:!t.range||!(t.set.length<2||t.values.indexOf(t.set[1])<0)||null};function o(t,e,s){return s||(s=Math.random),t+Math.floor(s()*(e-t+1))}function a(t,e,s){const i=[];for(let n=t;n<e+1;n++)s(n)&&i.push(n);if(i===[])throw new Error("overfiltered");return i[o(0,i.length-1)]}function r(t,e,s){return o((t=Math.ceil(t/s)*s)/s,(e=Math.floor(e/s)*s)/s)*s}function h(t,e){if(0===[...t].length)throw new Error("empty array");e||(e=Math.random);const s=o(0,(t.length||t.size)-1,e);return[...t][s]}function l(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function d(t){return Math.sin(t*Math.PI/180)}function c(t,e){if(0===e)return t;const s=Math.pow(10,e),i=Math.floor(t/s),n=t%s;return 0===n?i:i+"."+n}function u(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function p(t,e){return Array.isArray(t)&&t.includes(e)}function m(t,e,s){const i=document.createElement(t);return e&&(i.className=e),s&&s.appendChild(i),i}function f(t,e,s,i,n){const o=Math.hypot(i-e,n-s),a=(s-n)/o,r=(i-e)/o,h=(e+i)/2,l=(s+n)/2;t.moveTo(e,s),t.lineTo(i,n),t.moveTo(h+5*a,l+5*r),t.lineTo(h-5*a,l-5*r),t.moveTo(i,n)}class g{constructor(t,e){this.optionsSpec=t,this.options={},this.optionsSpec.forEach(t=>{v(t)&&"suboptions"!==t.type&&"range"!==t.type?this.options[t.id]=t.default:"range"===t.type?(this.options[t.idLB]=t.defaultLB,this.options[t.idUB]=t.defaultUB):"suboptions"===t.type&&(t.subOptionsSet=new g(t.optionsSpec),this.options[t.id]=t.subOptionsSet.options)}),this.template=e,this.globalId=g.getId()}static getId(){if(g.idCounter>=Math.pow(26,2))throw new Error("Too many options objects!");const t=String.fromCharCode(97+~~(g.idCounter/26))+String.fromCharCode(g.idCounter%26+97);return g.idCounter+=1,t}updateStateFromUI(t){if("string"==typeof t){const e=this.optionsSpec.find(e=>e.id===t);if(void 0===e)throw new Error(`no option with id '${t}'`);t=e}if(!t.element)throw new Error(`option ${t.id} doesn't have a UI element`);switch(t.type){case"int":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=Number(e.value);break}case"bool":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=e.checked;break}case"select-exclusive":this.options[t.id]=t.element.querySelector("input:checked").value;break;case"select-inclusive":this.options[t.id]=Array.from(t.element.querySelectorAll("input:checked")).map(t=>t.value);break;case"range":{const e=t.element.getElementsByTagName("input")[0],s=t.element.getElementsByTagName("input")[1];this.options[t.idLB]=Number(e.value),this.options[t.idUB]=Number(s.value);break}default:throw new Error(`option with id ${t.id} has unrecognised option type ${t.type}`)}console.log(this.options)}updateStateFromUIAll(){this.optionsSpec.forEach(t=>{v(t)&&this.updateStateFromUI(t)})}disableOrEnableAll(){this.optionsSpec.forEach(t=>this.disableOrEnable(t))}updateUIFromState(t){}disableOrEnable(t){if("string"==typeof t){const e=this.optionsSpec.find(e=>v(e)&&e.id===t);if(void 0===e)throw new Error(`no option with id '${t}'`);t=e}if(!v(t)||!t.enabledIf||void 0===t.element)return;const e=t.enabledIf.split("&");let s=!0;for(let t=0;t<e.length;t++){let i=e[t];if(i.startsWith("!")&&(i=i.slice(1)),"boolean"!=typeof this.options[i])throw new Error(`Invalid 'enabledIf': ${i} is not a boolean option`);//!== negate // !== equivalent to XOR
if(!this.options[i]){s=!1;break}}s?(t.element.classList.remove("disabled"),[...t.element.getElementsByTagName("input")].forEach(t=>{t.disabled=!1})):(t.element.classList.add("disabled"),[...t.element.getElementsByTagName("input")].forEach(t=>{t.disabled=!0}))}renderIn(t,e){const s=m("ul","options-list");e&&s.classList.add(e);let i=m("div","options-column",s);return this.optionsSpec.forEach(t=>{if("column-break"===t.type)i=m("div","options-column",s);else if("suboptions"===t.type){const e=t.subOptionsSet.renderIn(i,"suboptions");t.element=e}else{const e=m("li",void 0,i);switch(v(t)&&(e.dataset.optionId=t.id),t.type){case"heading":!function(t,e){e.innerHTML=t,e.classList.add("options-heading")}(t.title,e);break;case"int":case"bool":!function(t,e){const s=m("label",void 0,e);t.swapLabel||""===t.title||s.insertAdjacentHTML("beforeend",t.title+": ");const i=m("input","option",s);switch(t.type){case"int":i.type="number",i.min=t.min.toString(),i.max=t.max.toString(),i.value=t.default.toString();break;case"bool":i.type="checkbox",i.checked=t.default;break;default:throw new Error("Typescript is pretty sure I can't get here")}t.swapLabel&&""!==t.title&&s.insertAdjacentHTML("beforeend"," "+t.title)}(t,e);break;case"select-inclusive":case"select-exclusive":this.renderListOption(t,e);break;case"range":!function(t,e){const s=m("label",void 0,e),i=m("input","option",s);i.type="number",i.min=t.min.toString(),i.max=t.max.toString(),i.value=t.defaultLB.toString(),s.insertAdjacentHTML("beforeend",` &leq; ${t.title} &leq; `);const n=m("input","option",s);n.type="number",n.min=t.min.toString(),n.max=t.max.toString(),n.value=t.defaultUB.toString()}(t,e)}e.addEventListener("change",e=>{this.updateStateFromUI(t),this.disableOrEnableAll()}),t.element=e}}),t.append(s),this.disableOrEnableAll(),s}renderWithTemplate(t){this.optionsSpec.forEach(t=>{v(t)&&(undefined[t.id]=t)});this.template}renderListOption(t,e){e.insertAdjacentHTML("beforeend",t.title+": ");const s=m("ul","options-sublist",e);t.vertical&&s.classList.add("options-sublist-vertical"),t.selectOptions.forEach(e=>{const i=m("li",void 0,s),n=m("label",void 0,i),o=document.createElement("input");o.type="select-exclusive"===t.type?"radio":"checkbox",o.name=this.globalId+"-"+t.id,o.value=e.id,"select-inclusive"===t.type?o.checked=t.default.includes(e.id):o.checked=t.default===e.id,n.append(o),o.classList.add("option"),n.insertAdjacentHTML("beforeend",e.title)})}}function v(t){return void 0!==t.id}g.idCounter=0;class w{constructor(){this.DOM=document.createElement("div"),this.DOM.className="question-div",this.answered=!1}getDOM(){return this.DOM}showAnswer(){this.answered=!0}hideAnswer(){this.answered=!1}toggleAnswer(){this.answered?this.hideAnswer():this.showAnswer()}static get commandWord(){return""}}class y extends w{constructor(t){super();const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label,this.questionLaTeX="2+2",this.answerLaTeX="=5",this.questionp=document.createElement("p"),this.answerp=document.createElement("p"),this.questionp.className="question",this.answerp.className="answer",this.answerp.classList.add("hidden"),this.DOM.appendChild(this.questionp),this.DOM.appendChild(this.answerp)}render(){var t=this.label?"\\text{"+this.label+") }":"";katex.render(t+this.questionLaTeX,this.questionp,{displayMode:!0,strict:"ignore"}),katex.render(this.answerLaTeX,this.answerp,{displayMode:!0})}getDOM(){return this.DOM}showAnswer(){this.answerp.classList.remove("hidden"),this.answered=!0}hideAnswer(){this.answerp.classList.add("hidden"),this.answered=!1}}function x(t,e,s){return 0===t&&0===e&&0===s?"0":(0===t?"":1===t?"x^2":-1===t?"-x^2":t+"x^2")+(e<0?"-":0===t||0===e?"":"+")+(0===e?"":1===e||-1===e?"x":Math.abs(e)+"x")+(s<0?"-":0===t&&0===e||0===s?"":"+")+(0===s?"":Math.abs(s))}function b(t,e,s,i){var n=u(t,e);t/=n,e/=n;var o=u(s,i);s/=o,i/=o;var a=!1;return(u(n,o)>1||t===s&&e===i)&&(a=!0),a}class C{constructor(t,e){this.x=t,this.y=e}rotate(t){var e,s;return e=Math.cos(t)*this.x-Math.sin(t)*this.y,s=Math.sin(t)*this.x+Math.cos(t)*this.y,this.x=e,this.y=s,this}scale(t){return this.x=this.x*t,this.y=this.y*t,this}translate(t,e){return this.x+=t,this.y+=e,this}clone(){return new C(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}moveToward(t,e){const s=C.unitVector(this,t);return this.translate(s.x*e,s.y*e),this}static fromPolar(t,e){return new C(Math.cos(e)*t,Math.sin(e)*t)}static fromPolarDeg(t,e){return e=e*Math.PI/180,C.fromPolar(t,e)}static mean(...t){const e=t.map(t=>t.x).reduce((t,e)=>t+e),s=t.map(t=>t.y).reduce((t,e)=>t+e),i=t.length;return new C(e/i,s/i)}static inCenter(t,e,s){const i=C.distance(e,s),n=C.distance(t,s),o=C.distance(t,e),a=i+n+o,r=i*t.x+n*e.x+o*s.x,h=i*t.y+n*e.y+o*s.y;return new C(r/a,h/a)}static min(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0);return new C(e,s)}static max(t){const e=t.reduce((t,e)=>Math.max(t,e.x),-1/0),s=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new C(e,s)}static center(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0),i=t.reduce((t,e)=>Math.max(t,e.x),-1/0),n=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new C((i+e)/2,(n+s)/2)}static unitVector(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.hypot(s,i);return{x:s/n,y:i/n}}static distance(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}static angleFrom(t,e){const s=Math.atan2(e.y-t.y,e.x-t.x);return s>=0?s:2*Math.PI+s}static repel(t,e,s,i){const n=Math.hypot(t.x-e.x,t.y-e.y);if(n>=s)return!1;const o=(i-n)/2;return t.moveToward(e,-o),e.moveToward(t,-o),!0}static scaleToFit(t,e,s,i=0,n=[0,0]){let o=C.min(t),a=C.max(t);const r=a.x-o.x,h=a.y-o.y,l=Math.min((e-i)/r,(s-i)/h);t.forEach(t=>{t.scale(l)}),o=C.min(t),a=C.max(t);const d=C.mean(o,a).translate(...n);return t.forEach(t=>{t.translate(e/2-d.x,s/2-d.y)}),l}}class L{constructor(t,e){var s,i;e.width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300,this.width=e.width,this.height=e.height,this.data=t,this.rotation=e.rotation,this.labels=[],this.DOM=m("div","question-div"),this.canvas=m("canvas","question-canvas",this.DOM),this.canvas.width=this.width,this.canvas.height=this.height}getDOM(){return this.DOM}renderLabels(t){const e=this.DOM,s=e.getElementsByClassName("label");for(;s.length>0;)s[0].remove();this.labels.forEach(s=>{const i=document.createElement("div"),n=document.createElement("div");if(i.classList.add("label"),i.className+=" "+s.style,i.style.left=s.pos.x+"px",i.style.top=s.pos.y+"px",katex.render(s.text,n),i.appendChild(n),e.appendChild(i),n.offsetWidth/n.offsetHeight>2){console.log("removed space in "+s.text);const t=s.text.replace(/\+/,"\\!+\\!").replace(/-/,"\\!-\\!");katex.render(t,n)}if(t){const t=i.offsetWidth;s.pos.x<this.canvas.width/2-5&&s.pos.x+t/2>this.canvas.width/2&&(i.style.left=this.canvas.width/2-t-3+"px",console.log(`nudged '${s.text}'`)),s.pos.x>this.canvas.width/2+5&&s.pos.x-t/2<this.canvas.width/2&&(i.style.left=this.canvas.width/2+3+"px",console.log(`nudged '${s.text}'`))}})}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!1)}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!1)}get allpoints(){return[]}scale(t){this.allpoints.forEach((function(e){e.scale(t)}))}rotate(t){return this.allpoints.forEach((function(e){e.rotate(t)})),t}translate(t,e){this.allpoints.forEach((function(s){s.translate(t,e)}))}randomRotate(){const t=2*Math.PI*Math.random();return this.rotate(t),t}scaleToFit(t,e,s){let i=C.min(this.allpoints),n=C.max(this.allpoints);const o=n.x-i.x,a=n.y-i.y,r=Math.min((t-s)/o,(e-s)/a);this.scale(r),i=C.min(this.allpoints),n=C.max(this.allpoints);const h=C.mean(i,n);return this.translate(t/2-h.x,e/2-h.y),r}}class M extends w{constructor(t,e){super(),this.data=t,this.view=e,this.DOM=this.view.DOM}getDOM(){return this.view.getDOM()}render(){this.view.render()}showAnswer(){super.showAnswer(),this.view.showAnswer()}hideAnswer(){super.hideAnswer(),this.view.hideAnswer()}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function S(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function A(t,e,s){return t(s={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&s.path)}},s.exports),s.exports}var B=S(A((function(t,e){
/**
   * @license Fraction.js v4.0.9 09/09/2015
   * http://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2015, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **/
!function(s){var i={s:1,n:0,d:1};function n(t){function e(){var e=Error.apply(this,arguments);e.name=this.name=t,this.stack=e.stack,this.message=e.message}function s(){}return s.prototype=Error.prototype,e.prototype=new s,e}var o=c.DivisionByZero=n("DivisionByZero"),a=c.InvalidParameter=n("InvalidParameter");function r(t,e){return isNaN(t=parseInt(t,10))&&h(),t*e}function h(){throw new a}var l=function(t,e){var s,n=0,a=1,l=1,d=0,c=0,u=0,p=1,m=1,f=0,g=1,v=1,w=1,y=1e7;if(null==t);else if(void 0!==e)l=(n=t)*(a=e);else switch(typeof t){case"object":"d"in t&&"n"in t?(n=t.n,a=t.d,"s"in t&&(n*=t.s)):0 in t?(n=t[0],1 in t&&(a=t[1])):h(),l=n*a;break;case"number":if(t<0&&(l=t,t=-t),t%1==0)n=t;else if(t>0){for(t>=1&&(t/=m=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));g<=y&&w<=y;){if(t===(s=(f+v)/(g+w))){g+w<=y?(n=f+v,a=g+w):w>g?(n=v,a=w):(n=f,a=g);break}t>s?(f+=v,g+=w):(v+=f,w+=g),g>y?(n=v,a=w):(n=f,a=g)}n*=m}else(isNaN(t)||isNaN(e))&&(a=n=NaN);break;case"string":if(null===(g=t.match(/\d+|./g))&&h(),"-"===g[f]?(l=-1,f++):"+"===g[f]&&f++,g.length===f+1?c=r(g[f++],l):"."===g[f+1]||"."===g[f]?("."!==g[f]&&(d=r(g[f++],l)),(++f+1===g.length||"("===g[f+1]&&")"===g[f+3]||"'"===g[f+1]&&"'"===g[f+3])&&(c=r(g[f],l),p=Math.pow(10,g[f].length),f++),("("===g[f]&&")"===g[f+2]||"'"===g[f]&&"'"===g[f+2])&&(u=r(g[f+1],l),m=Math.pow(10,g[f+1].length)-1,f+=3)):"/"===g[f+1]||":"===g[f+1]?(c=r(g[f],l),p=r(g[f+2],1),f+=3):"/"===g[f+3]&&" "===g[f+1]&&(d=r(g[f],l),c=r(g[f+2],l),p=r(g[f+4],1),f+=5),g.length<=f){l=n=u+(a=p*m)*d+m*c;break}default:h()}if(0===a)throw new o;i.s=l<0?-1:1,i.n=Math.abs(n),i.d=Math.abs(a)};function d(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function c(t,e){if(!(this instanceof c))return new c(t,e);l(t,e),t=c.REDUCE?d(i.d,i.n):1,this.s=i.s,this.n=i.n/t,this.d=i.d/t}c.REDUCE=1,c.prototype={s:1,n:0,d:1,abs:function(){return new c(this.n,this.d)},neg:function(){return new c(-this.s*this.n,this.d)},add:function(t,e){return l(t,e),new c(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(t,e){return l(t,e),new c(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(t,e){return l(t,e),new c(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(t,e){return l(t,e),new c(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return new c(this)},mod:function(t,e){return isNaN(this.n)||isNaN(this.d)?new c(NaN):void 0===t?new c(this.s*this.n%this.d,1):(l(t,e),0===i.n&&0===this.d&&c(0,0),new c(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d))},gcd:function(t,e){return l(t,e),new c(d(i.n,this.n)*d(i.d,this.d),i.d*this.d)},lcm:function(t,e){return l(t,e),0===i.n&&0===this.n?new c:new c(i.n*this.n,d(i.n,this.n)*d(i.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new c(this.s*this.d,this.n)},pow:function(t){return t<0?new c(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new c(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,e){return l(t,e),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(t,e){l(t,e);var s=this.s*this.n*i.d-i.s*i.n*this.d;return(s>0)-(s<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var e=this.abs().toContinued();function s(t){return 1===t.length?new c(t[0]):s(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var i=0;i<e.length;i++){var n=s(e.slice(0,i+1));if(n.sub(this.abs()).abs().valueOf()<t)return n.mul(this.s)}return this},divisible:function(t,e){return l(t,e),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,s+=" ",i%=n),s+=i,s+="/",s+=n),s},toLatex:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,i%=n),s+="\\frac{",s+=i,s+="}{",s+=n,s+="}"),s},toContinued:function(){var t,e=this.n,s=this.d,i=[];if(isNaN(this.n)||isNaN(this.d))return i;do{i.push(Math.floor(e/s)),t=e%s,e=s,s=t}while(1!==e);return i},toString:function(t){var e,s=this.n,i=this.d;if(isNaN(s)||isNaN(i))return"NaN";c.REDUCE||(s/=e=d(s,i),i/=e),t=t||15;var n=function(t,e){for(;e%2==0;e/=2);for(;e%5==0;e/=5);if(1===e)return 0;for(var s=10%e,i=1;1!==s;i++)if(s=10*s%e,i>2e3)return 0;return i}(0,i),o=function(t,e,s){for(var i=1,n=function(t,e,s){for(var i=1;e>0;t=t*t%s,e>>=1)1&e&&(i=i*t%s);return i}(10,s,e),o=0;o<300;o++){if(i===n)return o;i=10*i%e,n=10*n%e}return 0}(0,i,n),a=-1===this.s?"-":"";if(a+=s/i|0,s%=i,(s*=10)&&(a+="."),n){for(var r=o;r--;)a+=s/i|0,s%=i,s*=10;a+="(";for(r=n;r--;)a+=s/i|0,s%=i,s*=10;a+=")"}else for(r=t;s&&r--;)a+=s/i|0,s%=i,s*=10;return a}},Object.defineProperty(e,"__esModule",{value:!0}),c.default=c,c.Fraction=c,t.exports=c}()})));class E{constructor(t,e){!isNaN(t)&&e instanceof Map?(this.c=t,this.vs=e):"string"==typeof t?this.initStr(t):isNaN(t)?(this.c=4,this.vs=new Map([["x",2],["y",1]])):(this.c=t,this.vs=new Map)}clone(){const t=new Map(this.vs);return new E(this.c,t)}mul(t){t instanceof E||(t=new E(t));const e=this.c*t.c;let s=new Map;return this.vs.forEach((e,i)=>{t.vs.has(i)?s.set(i,this.vs.get(i)+t.vs.get(i)):s.set(i,this.vs.get(i))}),t.vs.forEach((e,i)=>{s.has(i)||s.set(i,t.vs.get(i))}),s=new Map([...s.entries()].sort()),new E(e,s)}toLatex(){if(0===this.vs.size)return this.c.toString();let t=1===this.c?"":-1===this.c?"-":this.c.toString();return this.vs.forEach((e,s)=>{t+=1===e?s:s+"^"+e}),t}sort(){this.vs=new Map([...this.vs.entries()].sort())}cleanZeros(){this.vs.forEach((t,e)=>{0===t&&this.vs.delete(e)})}like(t){t instanceof E||(t=new E(t));let e=!0;return this.vs.forEach((s,i)=>{t.vs.has(i)&&t.vs.get(i)===s||(e=!1)}),t.vs.forEach((t,s)=>{this.vs.has(s)&&this.vs.get(s)===t||(e=!1)}),e}add(t,e){if(t instanceof E||(t=new E(t)),void 0===e&&(e=!0),e&&!this.like(t))throw new Error("Adding unlike terms");const s=this.c+t.c,i=this.vs;return new E(s,i)}initStr(t){const e=t.match(/^-?\d*/)[0],s=""===e?1:"-"===e?-1:parseInt(e);let i=t.match(/([a-zA-Z])(\^\d+)?/g);i||(i=[]);for(let t=0;t<i.length;t++){const e=i[t].split("^");e[1]=e[1]?parseInt(e[1]):1,i[t]=e}i=i.filter(t=>0!==t[1]),this.c=s,this.vs=new Map(i)}static var(t){const e=new Map([[t,1]]);return new E(1,e)}}class k{constructor(t){Array.isArray(t)&&t[0]instanceof E?(t.map(t=>t.clone()),this.terms=t):isNaN(t)?"string"==typeof t&&this.initStr(t):this.initNum(t)}initStr(t){t=(t=(t=t.replace(/\+-/g,"-")).replace(/-/g,"+-")).replace(/\s/g,""),this.terms=t.split("+").map(t=>new E(t)).filter(t=>0!==t.c)}initNum(t){this.terms=[new E(t)]}toLatex(){let t="";for(let e=0;e<this.terms.length;e++)e>0&&this.terms[e].c>=0&&(t+="+"),t+=this.terms[e].toLatex();return t}toString(){return this.toLaTeX()}clone(){const t=this.terms.map(t=>t.clone());return new k(t)}simplify(){const t=this.terms.slice();let e=[];for(let s=0;s<t.length;s++){if(!t[s])continue;let i=t[s];for(let e=s+1;e<t.length;e++)t[e]&&t[e].like(t[s])&&(i=i.add(t[e]),t[e]=null);e.push(i),t[s]=null}return e=e.filter(t=>0!==t.c),new k(e)}add(t,e){t instanceof k||(t=new k(t)),void 0===e&&(e=!0);const s=this.terms.concat(t.terms);let i=new k(s);return e&&(i=i.simplify()),i}mul(t,e){t instanceof k||(t=new k(t));const s=[];void 0===e&&(e=!0);for(let e=0;e<this.terms.length;e++)for(let i=0;i<t.terms.length;i++)s.push(this.terms[e].mul(t.terms[i]));let i=new k(s);return e&&(i=i.simplify()),i}pow(t,e){let s=this;for(let e=1;e<t;e++)s=s.mul(this);return e&&(s=s.simplify()),s}static var(t){const e=[E.var(t)];return new k(e)}static x(){return k.var("x")}static const(t){return new k(t)}}class T extends M{constructor(t){const e=new q(t);super(e,new O(e,t))}static get commandWord(){return"Complete the arithmagon:"}}T.optionsSpec=[{title:"Vertices",id:"n",type:"int",min:3,max:20,default:3},{title:"Type",id:"type",type:"select-exclusive",selectOptions:[{title:"Integer (+)",id:"integer-add"},{title:"Integer (×)",id:"integer-multiply"},{title:"Fraction (+)",id:"fraction-add"},{title:"Fraction (×)",id:"fraction-multiply"},{title:"Algebra (+)",id:"algebra-add"},{title:"Algebra (×)",id:"algebra-multiply"}],default:"integer-add",vertical:!0},{title:"Puzzle type",type:"select-exclusive",id:"puz_diff",selectOptions:[{title:"Missing edges",id:"1"},{title:"Mixed",id:"2"},{title:"Missing vertices",id:"3"}],default:"1"}];class q{constructor(t){switch(this.settings=Object.assign({},{n:3,min:-20,max:20,num_diff:1,puz_diff:1,type:"integer-add"},this.settings,t),this.settings.num_diff=this.settings.difficulty,this.settings.puz_diff=parseInt(this.settings.puz_diff),//! ? This should have been done upstream...
this.n=this.settings.n,this.vertices=[],this.sides=[],this.settings.type.endsWith("add")?(this.opname="+",this.op=(t,e)=>t.add(e)):this.settings.type.endsWith("multiply")&&(this.opname="×",this.op=(t,e)=>t.mul(e)),this.settings.type){case"integer-add":case"integer-multiply":this.initInteger(this.settings);break;case"fraction-add":this.initFractionAdd(this.settings);break;case"fraction-multiply":this.initFractionMultiply(this.settings);break;case"algebra-add":this.initAlgebraAdd(this.settings);break;case"algebra-multiply":this.initAlgebraMultiply(this.settings);break;default:throw new Error("Unexpected switch default")}this.calculateEdges(),this.hideLabels(this.settings.puz_diff)}initInteger(t){for(let e=0;e<this.n;e++)this.vertices[e]={val:new B(a(t.min,t.max,e=>t.type.endsWith("add")||0!==e)),hidden:!1}}initFractionAdd(t){const e=t.num_diff;if(e<3){const t=h([5,7,9,11,13,17]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val.n:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val.n:void 0,o=a(1,2===e?t-1:n?t-Math.max(n,i):i?t-i:t-1,e=>!(1!==u(e,t)||i&&1!==u(e+i,t)&&e+i!==t||n&&1!==u(e+n,t)&&e+n!==t));this.vertices[s]={val:new B(o,t),hidden:!1}}}else{const t=h(e<7?[2,3,5]:[2,3,4,5,6,7,8,9,10,11]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val:void 0,o=e<7?4:8,r=s%2==1||e>4?a(2,o,e=>!(i&&e===i.d/t||n&&e===n.d/t)):1,h=t*r;let l;l=e<6?a(1,h-1,t=>1===u(t,h)&&(e>=4||!i||i.add(t,h)<=1)&&(e>=4||!n||n.add(t,h)<=1)):e<8?a(h+1,6*h,t=>1===u(t,h)):a(10*h,100*h,t=>1===u(t,h)),this.vertices[s]={val:new B(l,h),hidden:!1}}}}initFractionMultiply(t){for(let t=0;t<this.n;t++){const e=o(2,10),s=o(1,e-1);this.vertices[t]={val:new B(s,e),hidden:!1}}}initAlgebraAdd(t){switch(t.num_diff){case 1:{const t=String.fromCharCode(o(97,122));for(let e=0;e<this.n;e++){const s=o(1,10).toString();this.vertices[e]={val:new k(s+t),hidden:!1}}}break;case 2:default:if(Math.random()<.5){const t=String.fromCharCode(o(97,122));for(let e=0;e<this.n;e++){const s=o(1,10).toString(),i=o(1,10).toString();this.vertices[e]={val:new k(s+t+"+"+i),hidden:!1}}}else{const t=String.fromCharCode(o(97,122));let e=t;for(;e===t;)e=String.fromCharCode(o(97,122));for(let s=0;s<this.n;s++){const i=o(1,10).toString(),n=o(1,10).toString();this.vertices[s]={val:new k(i+t+"+"+n+e),hidden:!1}}}}}initAlgebraMultiply(t){const e=t.num_diff;switch(e){case 1:{const t=String.fromCharCode(o(97,122));for(let e=0;e<this.n;e++){const s=o(1,10).toString(),i=e%2==0?s:s+t;this.vertices[e]={val:new k(i),hidden:!1}}break}case 2:{const t=String.fromCharCode(o(97,122)),e=String.fromCharCode(o(97,122));for(let s=0;s<this.n;s++){const i=o(1,10).toString(),n=h([t,e]);this.vertices[s]={val:new k(i+n),hidden:!1}}break}case 3:{const t=String.fromCharCode(o(97,122));for(let e=0;e<this.n;e++){const s=o(1,10).toString(),i=o(1,3).toString();this.vertices[e]={val:new k(s+t+"^"+i),hidden:!1}}break}case 4:{const t=o(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1),i=String.fromCharCode(t+2);for(let t=0;t<this.n;t++){const n=o(1,10).toString()+e+("^"+o(0,3).toString())+s+("^"+o(0,3).toString())+i+("^"+o(0,3).toString());this.vertices[t]={val:new k(n),hidden:!1}}break}case 5:case 6:{const t=String.fromCharCode(o(97,122));for(let s=0;s<this.n;s++){const i=o(1,10).toString(),n=o(-9,9).toString();let a=i;6!==e&&s%2!=1||(a+=t),s%2==1&&(a+="+"+n),this.vertices[s]={val:new k(a),hidden:!1}}break}case 7:{const t=o(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1);for(let t=0;t<this.n;t++){let i=o(1,10).toString()+e+("^"+o(0,3).toString())+s+("^"+o(0,3).toString());if(t%2==1){i+="+"+o(-9,9).toString()+e+("^"+o(0,3).toString())+s+("^"+o(0,3).toString())}this.vertices[t]={val:new k(i),hidden:!1}}break}case 8:default:{const t=String.fromCharCode(o(97,122));for(let e=0;e<this.n;e++){const s=o(-9,9).toString();this.vertices[e]={val:new k(t+"+"+s),hidden:!1}}}}}calculateEdges(){for(let t=0;t<this.n;t++)this.sides[t]={val:this.op(this.vertices[t].val,this.vertices[(t+1)%this.n].val),hidden:!1}}hideLabels(t){switch(t){case 1:this.sides.forEach(t=>{t.hidden=!0});break;case 2:{this.sides.forEach(t=>{t.hidden=!0});const t=o(0,this.n-1,Math.random),e=Math.random()<.5?t:(t+1)%this.n;this.sides[t].hidden=!1,this.vertices[e].hidden=!0;break}case 3:this.vertices.forEach(t=>{t.hidden=!0});break;default:throw new Error("no_difficulty")}}}class O extends L{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=.35*Math.min(s,i),o=this.data.n;this.operationPoint=new C(0,0),this.vertexPoints=[];for(let t=0;t<o;t++){const e=t*Math.PI*2/o-Math.PI/2;this.vertexPoints[t]=C.fromPolar(n,e)}this.sidePoints=[];for(let t=0;t<o;t++)this.sidePoints[t]=C.mean(this.vertexPoints[t],this.vertexPoints[(t+1)%o]);this.allPoints=[this.operationPoint].concat(this.vertexPoints).concat(this.sidePoints),this.reCenter(),this.makeLabels(!0)}reCenter(){const t=C.min(this.allPoints),e=C.max(this.allPoints),s=C.mean(t,e);this.allPoints.forEach(t=>{t.translate(this.width/2-s.x,this.height/2-s.y)})}makeLabels(){this.data.vertices.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.vertexPoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal vertex",stylea:t.hidden?"answer vertex":"normal vertex"})}),this.data.sides.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.sidePoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal side",stylea:t.hidden?"answer side":"normal side"})}),this.labels.push({pos:this.operationPoint,textq:this.data.opname,texta:this.data.opname,styleq:"normal",stylea:"normal"}),this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq})}render(){const t=this.canvas.getContext("2d"),e=this.data.n;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath();for(let s=0;s<e;s++){const i=this.vertexPoints[s],n=this.vertexPoints[(s+1)%e];t.moveTo(i.x,i.y),t.lineTo(n.x,n.y)}t.stroke(),t.closePath(),this.renderLabels(!0)}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!0),this.answered=!0}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!0),this.answered=!1}}class N extends y{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a",test1:["foo"],test2:!0},t);let s;this.label=e.label,s=0===e.test1.length?"none":h(e.test1),this.questionLaTeX="d: "+e.difficulty+"\\\\ test1: "+s,this.answerLaTeX="test2: "+e.test2,this.render()}static get commandWord(){return"Test command word"}}N.optionsSpec=[{title:"Test option 1",id:"test1",type:"select-inclusive",selectOptions:["foo","bar","wizz"],default:[]},{title:"Test option 2",id:"test2",type:"bool",default:!0}];class P extends y{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label;const s=String(o(1,9))+String(o(0,9))+"."+String(o(0,9)),i=s+"0";this.questionLaTeX=s+"\\times 10",this.answerLaTeX="= "+i,this.render()}static get commandWord(){return"Evaluate"}}P.optionsSpec=[];class _ extends L{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=this.radius=Math.min(s,i)/2.5,o=e.minViewAngle||25;this.viewAngles=function(t,e){const s=t.reduce((t,e)=>t+e),i=t.map((t,e)=>[t,e]),n=i.filter(t=>t[0]<e),o=i.filter(t=>t[0]>=e),a=o.reduce((t,e)=>t+e[0],0);n.forEach(t=>{const s=e-t[0];t[0]+=s,o.forEach(t=>{const e=s*t[0]/a;t[0]=Math.round(t[0]-e)})});let r=n.concat(o).sort((t,e)=>t[1]-e[1]).map(t=>t[0]),h=r.reduce((t,e)=>t+e);if(h!==s){const t=s-h;r[r.indexOf(Math.max(...r))]+=t}if(h=r.reduce((t,e)=>t+e),h!==s)throw new Error(`Didn't fix angles. New sum is ${h}, but should be ${s}`);return r}(this.data.angles,o),this.O=new C(0,0),this.A=new C(n,0),this.C=[];let a=0;for(let t=0;t<this.data.angles.length;t++)a+=this.viewAngles[t]*Math.PI/180,this.C[t]=C.fromPolar(n,a);this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate(),this.translate(s/2,i/2),a=180*C.angleFrom(this.O,this.A)/Math.PI;for(let t=0;t<this.viewAngles.length;t++){const e={},s=this.data.angleLabels[t],i=l(this.data.angles[t],2).toString()+"^\\circ",o=this.viewAngles[t],r=.4+6/o;e.pos=C.fromPolarDeg(n*r,a+o/2).translate(this.O.x,this.O.y),e.textq=s,e.styleq="normal",this.data.missing[t]?(e.texta=i,e.stylea="answer"):(e.texta=e.textq,e.stylea=e.styleq),e.text=e.textq,e.style=e.styleq,this.labels[t]=e,a+=o}this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq})}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get canvas context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.O.x,this.O.y),t.lineTo(this.A.x,this.A.y);for(let e=0;e<this.C.length;e++)t.moveTo(this.O.x,this.O.y),t.lineTo(this.C[e].x,this.C[e].y);t.strokeStyle="gray",t.stroke(),t.closePath(),t.beginPath();let e=this.rotation;for(let s=0;s<this.viewAngles.length;s++){const i=this.viewAngles[s]*Math.PI/180;t.arc(this.O.x,this.O.y,this.radius*(.2+.07/i),e,e+i),t.stroke(),e+=i}t.closePath(),this.renderLabels(!1)}get allpoints(){let t=[this.A,this.O];return t=t.concat(this.C),this.labels.forEach((function(e){t.push(e.pos)})),t}}class F{constructor(t,e,s,i){if(e===[])throw new Error("Must give angles");if(Math.round(e.reduce((t,e)=>t+e))!==t)throw new Error("Angle sum must be "+t);this.angles=e,this.missing=s,this.angleSum=t,this.angleLabels=i||[]}static random(t){let e;return e=t.repeated?this.randomRepeated(t):this.randomSimple(t),e.initLabels(),e}static randomSimple(t){const e=t.angleSum,s=o(t.minN,t.maxN),i=t.minAngle;if(s<2)throw new Error("Can't have missing fewer than 2 angles");const n=[];let a=e;for(let t=0;t<s-1;t++){const e=o(i,a-i*(s-t-1));a-=e,n.push(e)}n[s-1]=a;const r=[];return r.length=s,r.fill(!1),r[o(0,s-1)]=!0,new this(e,n,r)}static randomRepeated(t){const e=t.angleSum,s=t.minAngle,i=o(t.minN,t.maxN),n=t.nMissing||(Math.random()<.1?i:o(2,i-1));if(i<2||n<1||n>i)throw new Error(`Invalid arguments: n=${i}, m=${n}`);if(i===n){const t=[];t.length=i,t.fill(e/i);const s=[];return s.length=i,s.fill(!0),new this(e,t,s)}const a=[],r=[];r.length=i,r.fill(!1);const h=o(s,(e-s*(i-n))/n),l=[];let d=e-h*n;for(let t=0;t<i-n-1;t++){const e=o(s,d-s*(i-n-t-1));d-=e,l.push(e)}l[i-n-1]=d;{let t=0;for(;t<n;){const e=o(0,i-1);!1===r[e]&&(r[e]=!0,a[e]=h,t++)}}{let t=0;for(let e=0;e<i;e++)!1===r[e]&&(a[e]=l[t],t++)}return new this(e,a,r)}initLabels(){const t=this.angles.length;for(let e=0;e<t;e++)this.missing[e]?this.angleLabels[e]="x^\\circ":this.angleLabels[e]=this.angles[e].toString()+"^\\circ"}}class I extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,nMissing:3},t),i=F.random(s),n=new _(i,e);return new I(i,n)}static get commandWord(){return"Find the missing value"}}class D extends L{constructor(t,e){super(t,e);const s=this.width,i=this.height;this.A=new C(0,0),this.B=C.fromPolarDeg(1,t.angles[0]),this.C=new C(d(this.data.angles[1])/d(this.data.angles[2]),0);const n=C.inCenter(this.A,this.B,this.C);for(let t=0;t<3;t++){const e=[this.A,this.B,this.C][t],s={textq:this.data.angleLabels[t],text:this.data.angleLabels[t],styleq:"normal",style:"normal",pos:C.mean(e,e,n)};this.data.missing[t]?(s.texta=l(this.data.angles[t],2).toString()+"^\\circ",s.stylea="answer"):(s.texta=s.textq,s.stylea=s.styleq),this.labels[t]=s}this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate();let o=C.min([this.A,this.B,this.C]),a=C.max([this.A,this.B,this.C]);const r=a.x-o.x,h=a.y-o.y;this.scale(Math.min((s-0)/r,(i-0)/h)),o=C.min([this.A,this.B,this.C]),a=C.max([this.A,this.B,this.C]);const c=C.mean(o,a);this.translate(s/2-c.x,i/2-c.y)}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get canvas context");const e=[this.A,this.B,this.C],s=this.data.apex;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.A.x,this.A.y);for(let i=0;i<3;i++){const n=e[i],o=e[(i+1)%3];s===i||s===(i+1)%3?f(t,n.x,n.y,o.x,o.y):t.lineTo(o.x,o.y)}t.strokeStyle="gray",t.stroke(),t.closePath(),this.renderLabels(!1)}get allpoints(){const t=[this.A,this.B,this.C];return this.labels.forEach(e=>{t.push(e.pos)}),t}}class W extends F{constructor(t,e,s,i,n){super(t,e,s,i),this.apex=n}static randomRepeated(t){t.nMissing=2,t.givenAngle=t.givenAngle||Math.random()<.5?"apex":"base";const e=super.randomRepeated(t);return e.apex=function(t){let e=0;for(;e<t.length&&t.indexOf(t[e])!==t.lastIndexOf(t[e]);)e++;return e}(e.angles),e.missing=[!0,!0,!0],"apex"===t.givenAngle?e.missing[e.apex]=!1:e.missing[(e.apex+1)%3]=!1,e.initLabels(),e}initLabels(){const t=this.angles.length;let e=0;for(let s=0;s<t;s++)this.missing[s]?(this.angleLabels[s]=String.fromCharCode(120+e)+"^\\circ",e++):this.angleLabels[s]=this.angles[s].toString()+"^\\circ"}}class $ extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,nMissing:1},t,{angleSum:180,minAngle:25,minN:3,maxN:3}),i=W.random(s),n=new D(i,e);return new $(i,n)}static get commandWord(){return"Find the missing value"}}class R{constructor(t,e){this.a=t,this.b=e}isConstant(){return 0===this.a}toString(){let t="";return 1===this.a?t+="x":-1===this.a?t+="-x":0!==this.a&&(t+=this.a+"x"),0!==this.a&&this.b>0?t+=" + ":0!==this.a&&this.b<0&&(t+=" - "),this.b>0||this.b<0&&0===this.a?t+=this.b:this.b<0&&(t+=Math.abs(this.b)),t}toStringP(){return 0===this.a||0===this.b?this.toString():"("+this.toString()+")"}eval(t){return this.a*t+this.b}add(t){return void 0!==t.a?new R(this.a+t.a,this.b+t.b):new R(this.a,this.b+t)}times(t){return new R(this.a*t,this.b*t)}static solve(t,e){return(e.b-t.b)/(t.a-e.a)}}function j(t,e){const s=t.reduce((t,e)=>t.add(e)),i=R.solve(s,new R(0,e)),n=[];return t.forEach((function(t){if(t.eval(i)<=0)throw new Error("negative angle");n.push(t.eval(i))})),{x:i,angles:n}}class H{constructor(t,e,s,i,n){this.angles=t,this.angleSum=s,this.angleLabels=i,this.x=n,this.missing=e}static random(t){t.maxConstant=t.maxConstant||t.angleSum/2,t.maxXValue=t.maxXValue||t.angleSum/4;const e=o(t.minN,t.maxN);let s;switch(h(t.expressionTypes)){case"mixed":s=function(t,e){const s=[],i=o(e.minXValue,e.maxXValue);let n=e.angleSum,a=!0;for(let r=0;r<t-1;r++){const h=o(1,e.maxCoefficient);n-=h*i;const l=Math.min(n-e.minAngle*(t-r-1),e.maxConstant),d=o(e.minAngle-h*i,l);0!==h&&(a=!1),n-=d,s.push(new R(h,d))}const r=o(a?1:e.minCoefficient,e.maxCoefficient),h=n-r*i;return s.push(new R(r,h)),s}(e,t);break;case"multiply":s=function(t,e){const s=[],i=!0===e.includeConstants||p(e.includeConstants,"mult");2===t&&e.ensureX&&i&&(t=3);let n=t;const a=i?o(t,(e.angleSum-e.minAngle)/e.minAngle,Math.random):h([3,4,5,6,8,9,10].filter(e=>e>=t),Math.random);let l=a;if(i){n--;const t=r(a*e.minAngle,e.angleSum-e.minAngle,a),i=e.angleSum-t;s.push(new R(0,i))}e.ensureX&&(n--,s.push(new R(1,0)),l-=1);for(;n>1;){n--;const t=o(1,l-n);s.push(new R(t,0)),l-=t}return s.push(new R(l,0)),s}(e,t);break;case"add":default:s=function(t,e){const s=[],i=!0===e.includeConstants||p(e.includeConstants,"add");2===t&&e.ensureX&&i&&(t=3);const n=o(e.minXValue,e.maxXValue);let a=e.angleSum,r=t;e.ensureX&&(r--,s.push(new R(1,0)),a-=n);if(i){r--;const t=o(e.minAngle,a-e.minAngle*r);s.push(new R(0,t)),a-=t}for(;r>1;){r--,a-=n;const t=Math.min(a-e.minAngle*r,e.maxConstant),i=o(Math.max(e.minAngle-n,-e.maxConstant),t);s.push(new R(1,i)),a-=i}return s.push(new R(1,a-n)),s}(e,t)}s=function(t){for(var e,s,i=t.length;0!==i;)s=Math.floor(Math.random()*i),e=t[i-=1],t[i]=t[s],t[s]=e;return t}(s);const{x:i,angles:n}=j(s,t.angleSum),a=s.map(t=>t.toStringP()+"^\\circ"),l=s.map(t=>!t.isConstant());return new H(n,l,t.angleSum,a,i)}initLabels(){}}class X extends _{constructor(t,e){super(t,e);const s={pos:new C(10,this.height-10),textq:"",texta:`x = ${this.data.x}^\\circ`,styleq:"hidden",stylea:"extra-answer"};s.style=s.styleq,s.text=s.textq,this.labels.push(s)}}class V extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,expressionTypes:["add","multiply","mixed"],ensureX:!0,includeConstants:!0,minCoefficient:1,maxCoefficient:4,minXValue:15},t),i=H.random(s),n=new X(i,e);return new V(i,n)}static get commandWord(){return"Find the missing value"}static get optionsSpec(){return[{id:"expressionTypes",type:"select-inclusive",title:"Types of expression",selectOptions:[{title:"<em>a</em>+<em>x</em>",id:"add"},{title:"<em>ax</em>",id:"multiply"},{title:"mixed",id:"mixed"}],default:["add","multiply","mixed"]},{id:"ensureX",type:"bool",title:"Ensure one angle is <em>x</em>",default:!0},{id:"includeConstants",type:"bool",title:"Ensure a constant angle",default:!0}]}}class z extends D{constructor(t,e){super(t,e);const s={pos:new C(10,this.height-10),textq:"",texta:`x = ${this.data.x}^\\circ`,styleq:"hidden",stylea:"extra-answer"};s.style=s.styleq,s.text=s.textq,this.labels.push(s)}}class U extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minN:3,maxN:3,repeated:!1,minAngle:25,expressionTypes:["add","multiply","mixed"],ensureX:!0,includeConstants:!0,minCoefficient:1,maxCoefficient:4,minXValue:15},t,{angleSum:180,minN:3,maxN:3,repeated:!1}),i=H.random(s);return new this(i,new z(i,e))}static get commandWord(){return"Find the missing value"}}class G extends D{constructor(t,e){super(t,e),super.scaleToFit(this.width,this.height,40),super.translate(0,-30);const s={textq:this.data.instructions.join("\\\\"),texta:this.data.instructions.join("\\\\"),text:this.data.instructions.join("\\\\"),styleq:"extra-info",stylea:"extra-info",style:"extra-info",pos:new C(10,this.height-10)};this.labels.push(s)}}class Z{constructor(t,e,s,i,n){this.angles=t,this.missing=e,this.angleSum=s,this.angleLabels=i,this.instructions=n,this.instructions=n}static random(t){const e=o(t.minN,t.maxN),s=[];for(let t=0;t<e;t++)s[t]=String.fromCharCode(65+t);let i=[],n=[];i.push(new R(1,0));let a=!1,l=0;for(;!a;){l>20&&(i.push(new R(1,0)),console.log("Gave up after "+l+" attempts"),a=!0);for(let s=1;s<e;s++){switch(h(t.types)){case"add":{const e=o(t.minAddend,t.maxAddend);i.push(i[s-1].add(e)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is ${Q(e,"+")} angle $${String.fromCharCode(64+s)}$}`);break}case"multiply":{const e=o(t.minMultiplier,t.maxMultiplier);i.push(i[s-1].times(e)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is ${Q(e,"*")} angle $${String.fromCharCode(64+s)}$}`);break}case"percent":{const t=r(5,100,5),e=Math.random()<.5,o=e?1+t/100:1-t/100;i.push(i[s-1].times(o)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is $${t}\\%$ ${e?"bigger":"smaller"} than angle $${String.fromCharCode(64+s)}$}`);break}case"ratio":{const t=o(1,10),e=o(1,10),a=e/t;i.push(i[s-1].times(a)),n.push(`\\text{The ratio of angle $${String.fromCharCode(64+s)}$ to angle $${String.fromCharCode(65+s)}$ is $${t}:${e}$}`)}}}a=!0;const s=i.reduce((t,e)=>t.add(e)),d=R.solve(s,new R(0,t.angleSum));i.forEach((function(e){(!a||e.eval(d)<t.minAngle)&&(a=!1,n=[],i=[i[0]])})),l++}console.log("Attempts: "+l);const d=j(i,t.angleSum).angles,c=d.map(()=>!0);return new this(d,c,t.angleSum,s,n)}initLabels(){}}function Q(t,e){switch(e){case"*":switch(t){case 1:return"the same as";case 2:return"double";default:return`$${t}$ times larger than`}case"+":switch(t){case 0:return"the same as";default:return`$${Math.abs(t).toString()}^\\circ$ ${t<0?"less than":"more than"}`}}}class Y extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:25,minN:3,maxN:3,repeated:!1,minAddend:-60,maxAddend:60,minMultiplier:1,maxMultiplier:5,types:["add","multiply","percent","ratio"]},t,{angleSum:180,minN:3,maxN:3,repeated:!1}),i=Z.random(s);return new this(i,new G(i,e))}static get commandWord(){return"Find the missing value"}}class K extends _{constructor(t,e){super(t,e),super.translate(0,-15);const s={textq:this.data.instructions.join("\\\\"),texta:this.data.instructions.join("\\\\"),text:this.data.instructions.join("\\\\"),styleq:"extra-info",stylea:"extra-info",style:"extra-info",pos:new C(10,this.height-10)};this.labels.push(s)}}class J extends M{constructor(t,e){super(t,e)}static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:2,repeated:!1,minAddend:-90,maxAddend:90,minMultiplier:1,maxMultiplier:5,types:["add","multiply","percent","ratio"]},t),i=Z.random(s);return new this(i,new K(i,e))}static get optionsSpec(){return[{type:"select-inclusive",title:"Question types",id:"types",selectOptions:[{title:"More than/less than",id:"add"},{title:"Multiples",id:"multiply"},{title:"Percentage change",id:"percent"},{title:"Ratios",id:"ratio"}],default:["add","multiply"]}]}}class tt extends w{constructor(t){super(),this.question=t}static random(t){if(0===t.types.length)throw new Error("Types list must be non-empty");const e=h(t.types);if(t.custom){let s=[];["simple","repeated","algebra","worded"].forEach(e=>{t[e]&&s.push(e)});const i=h(s);let n={};return"simple"===i||"repeated"===i?n={}:"algebra"===i?n=t.algebraOptions:"worded"===i&&(n=t.wordedOptions),n.minN=t.minN,n.maxN=t.maxN,tt.randomFromTypeWithOptions(e,i,n)}return tt.randomFromDifficulty(e,t.difficulty)}static randomFromDifficulty(t,e){let s,i={};switch(e){case 1:s="simple",i.minN=2,i.maxN=2;break;case 2:s="simple",i.minN=3,i.maxN=4;break;case 3:s="repeated",i.minN=3,i.maxN=4;break;case 4:s="algebra",i.expressionTypes=["multiply"],i.includeConstants=!1,i.minN=2,i.maxN=4;break;case 5:s="algebra",i.expressionTypes=["add","multiply"],i.includeConstants=["multiply"],i.ensureX=!0,i.minN=2,i.maxN=3;break;case 6:s="algebra",i.expressionTypes=["mixed"],i.minN=2,i.maxN=3;break;case 7:s="worded",i.types=[h(["add","multiply"])],i.minN=i.maxN=2;break;case 8:s="worded",i.types=["add","multiply"],i.minN=i.maxN=3;break;case 9:s="worded",i.types=["multiply","ratio"],i.minN=i.maxN=3;break;case 10:s="worded",i.types=["multiply","add","ratio","percent"],i.minN=i.maxN=3;break;default:throw new Error("Can't generate difficulty "+e)}return this.randomFromTypeWithOptions(t,s,i)}static randomFromTypeWithOptions(t,e,s,i){let n;switch(s=s||{},i=i||{},t){case"aaap":case"aosl":switch(s.angleSum="aaap"===t?360:180,e){case"simple":case"repeated":s.repeated="repeated"===e,n=I.random(s,i);break;case"algebra":n=V.random(s,i);break;case"worded":n=J.random(s,i);break;default:throw new Error("unexpected subtype "+e)}break;case"triangle":switch(s.repeated="repeated"===e,e){case"simple":case"repeated":n=$.random(s,i);break;case"algebra":n=U.random(s,i);break;case"worded":n=Y.random(s,i);break;default:throw new Error("unexpected subtype "+e)}break;default:throw new Error("Unknown type "+t)}return new tt(n)}getDOM(){return this.question.getDOM()}render(){this.question.render()}showAnswer(){this.question.showAnswer()}hideAnswer(){this.question.hideAnswer()}toggleAnswer(){this.question.toggleAnswer()}static get optionsSpec(){return[{type:"heading",title:""},{title:"Types",id:"types",type:"select-inclusive",selectOptions:[{title:"On a straight line",id:"aosl"},{title:"Around a point",id:"aaap"},{title:"Triangle",id:"triangle"}],default:["aosl","aaap","triangle"],vertical:!0},{type:"column-break"},{type:"bool",title:"<b>Custom settings (disables difficulty)</b>",default:!1,id:"custom"},{type:"range",id:"n-angles",idLB:"minN",idUB:"maxN",defaultLB:2,defaultUB:4,min:2,max:8,title:"Number of angles",enabledIf:"custom"},{type:"bool",title:"Simple",id:"simple",default:!0,enabledIf:"custom"},{type:"bool",title:"Repeated/Isosceles",id:"repeated",default:!0,enabledIf:"custom"},{type:"bool",title:"Algebraic",id:"algebra",default:!0,enabledIf:"custom"},{type:"suboptions",title:"",id:"algebraOptions",optionsSpec:V.optionsSpec,enabledIf:"custom&algebra"},{type:"bool",title:"Worded",id:"worded",default:!0,enabledIf:"custom"},{type:"suboptions",title:"",id:"wordedOptions",optionsSpec:J.optionsSpec,enabledIf:"custom&worded"}]}static get commandWord(){return"Find the missing value"}}function et(t,e,s,i,n){n||(n=.5);let o=C.unitVector(e,s);o.x*=i,o.y*=i;let a={x:-o.y,y:o.x};a.x*=n,a.y*=n;const r=s.clone().translate(-o.x,-o.y).translate(a.x,a.y),h=s.clone().translate(-o.x,-o.y).translate(-a.x,-a.y);t.moveTo(e.x,e.y),t.lineTo(s.x,s.y),t.lineTo(r.x,r.y),t.moveTo(s.x,s.y),t.lineTo(h.x,h.y)}function st(t,e,s,i,n){const o=C.unitVector(s,e),a=C.unitVector(s,i),r=s.clone().translate(o.x*n,o.y*n),h=r.clone().translate(a.x*n,a.y*n),l=s.clone().translate(a.x*n,a.y*n);t.moveTo(r.x,r.y),t.lineTo(h.x,h.y),t.lineTo(l.x,l.y)}class it extends L{constructor(t,e,s,i,n,o,a){super(o,a),this.A=t,this.B=e,this.C=s,this.D=i,this.labels=n}static fromData(t,e){var s,i,n;(e=null!=e?e:{}).width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300;const o=new C(0,0),a=new C(0,t.height.val),r=new C(t.base.val,t.height.val),h=new C(t.base.val,0),l=null!==(n=e.rotation)&&void 0!==n?n:2*Math.PI*Math.random();[o,a,r,h].forEach(t=>t.rotate(l)),C.scaleToFit([o,a,r,h],e.width,e.height,80);let d=[];const c=[[o,a,t.height],[a,r,t.base]];t.showOpposites&&(c.push([r,h,t.height]),c.push([h,o,t.base]));for(let t=0,e=c.length;t<e;t++){if(!c[t][2].show)continue;const e=20;let s=C.mean(c[t][0],c[t][1]);const i=C.unitVector(c[t][0],c[t][1]);s.translate(-i.y*e,i.x*e);const n=c[t][2].val.toString()+"\\mathrm{cm}",o=c[t][2].missing?"?":n,a="normal",r=c[t][2].missing?"answer":"normal";d.push({pos:s,texta:n,textq:o,text:o,stylea:r,styleq:a,style:a})}let u=0;if(t.area.show){const s=t.area.val.toString()+"\\mathrm{cm}^2",i=t.area.missing?"?":s,n="extra-info",o=t.area.missing?"extra-answer":"extra-info";d.push({texta:"Area = "+s,textq:"Area = "+i,text:"Area = "+i,styleq:n,stylea:o,style:n,pos:new C(10,e.height-10-15*u)}),u++}if(t.perimeter.show){const s=t.perimeter.val.toString()+"\\mathrm{cm}",i=t.perimeter.missing?"?":s,n="extra-info",o=t.perimeter.missing?"extra-answer":"extra-info";d.push({pos:new C(10,e.height-10-20*u),texta:"Perimeter = "+s,textq:"Perimeter = "+i,text:"Perimeter = "+i,styleq:n,stylea:o,style:n})}return new it(o,a,r,h,d,t,e)}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setLineDash([]),t.beginPath(),t.moveTo(this.A.x,this.A.y),t.lineTo(this.B.x,this.B.y),t.lineTo(this.C.x,this.C.y),t.lineTo(this.D.x,this.D.y),t.lineTo(this.A.x,this.A.y),t.stroke(),t.fillStyle="LightGrey",t.fill(),t.closePath();const e=Math.min(15,Math.min(C.distance(this.A,this.B),C.distance(this.B,this.C))/3);t.beginPath(),st(t,this.A,this.B,this.C,e),st(t,this.B,this.C,this.D,e),st(t,this.C,this.D,this.A,e),st(t,this.D,this.A,this.B,e),t.stroke(),t.closePath(),this.renderLabels()}}class nt extends M{constructor(t,e){super(t,e)}static random(t,e){const s=class{constructor(t,e,s,i,n){this.base=t,this.height=e,this.showOpposites=s,this._area=i,this._perimeter=n}static random(t){t.maxLength=t.maxLength||20,t.dp=t.dp||0;const e={base:o(1,t.maxLength),height:o(1,t.maxLength)},s={val:e.base,show:!0,missing:!1},i={val:e.height,show:!0,missing:!1};let n,a={},r={};switch(t.questionType){case"area":a.show=!0,a.missing=!0,n=!t.noDistractors;break;case"perimeter":r.show=!0,r.missing=!0,n=t.noDistractors;break;case"reverseArea":a.show=!0,a.missing=!1,h([s,i]).missing=!0,n=!1;break;case"reversePerimeter":default:r.show=!0,r.missing=!1,h([s,i]).missing=!0,n=!1}return new this(s,i,n,a,r)}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=2*(this.base.val+this.height.val)),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.base.val*this.height.val),this._area}}.random(t);return new this(s,it.fromData(s,e))}static get commandWord(){return"Find the missing values"}}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function ot(t,e,s,i){return new(s||(s=Promise))((function(n,o){function a(t){try{h(i.next(t))}catch(t){o(t)}}function r(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}h((i=i.apply(t,e||[])).next())}))}const at={100:{length:361,path:"/data/triangles0-100.json",loaded:!1,data:[]},200:{length:715,path:"/data/triangles100-200.json",loaded:!1,data:[]},300:{length:927,path:"/data/triangles200-300.json",loaded:!1,data:[]},400:{length:1043,path:"/data/triangles300-400.json",loaded:!1,data:[]},500:{length:1151,path:"/data/triangles400-500.json",loaded:!1,data:[]}};function rt(t){return Math.max(t.b,t.s1,t.s2)}class ht{constructor(t,e,s,i,n,o,a){this.base=t,this.side1=e,this.side2=s,this.height=i,this.dp=n,this._area=o,this._perimeter=a}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=this.base.val+this.side1.val+this.side2.val,this._perimeter.label=c(this._perimeter.val,this.dp)+"\\mathrm{cm}"),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.base.val*this.height.val/2,this._area.label=c(this._area.val,2*this.dp)+"\\mathrm{cm}^2"),this._area}isRightAngled(){return lt({b:this.base.val,h:this.height.val,s1:this.side1.val,s2:this.side2.val})}static random(t){return ot(this,void 0,void 0,(function*(){t.maxLength=t.maxLength||20;const e=t.dp||0,s="pythagorasIsoscelesArea"===t.questionType,i="pythagorasArea"===t.questionType||"pythagorasPerimeter"===t.questionType,n=yield function(t,e){let s;e=null!=e?e:t=>!0,t>500&&(t=500);const i=r(0,t-1,50)+50,n=(100*Math.ceil(i/100)).toString(),o=at[n];return o.loaded?(console.log("Using cached data"),s=h(o.data.filter(s=>rt(s)<t&&e(s))),Promise.resolve(s)):(console.log("Loading data with XHR"),fetch("/dist/"+o.path).then(t=>t.ok?t.json():Promise.reject(t.statusText)).then(i=>(o.loaded||(o.loaded=!0,o.data=i),s=h(i.filter(s=>rt(s)<t&&e(s))),s)))}(t.maxLength,t=>(!s||function(t){return t.s1===t.s2}(t))&&(!i||lt(t))),o=lt(n),a={val:n.b,show:!0,missing:!1},l={val:n.h,show:!o,missing:!1},d={val:n.s1,show:!0,missing:!1},u={val:n.s2,show:!0,missing:!1};[a,l,d,u].forEach(t=>{t.label=c(t.val,e)+"\\mathrm{cm}"});const p=a,m=d.val>u.val?u:d,f=d.val>u.val?d:u,g={show:!1,missing:!0},v={show:!1,missing:!0};switch(t.questionType){case"area":g.show=!0,g.missing=!0;break;case"perimeter":v.show=!0,v.missing=!0;break;case"reverseArea":g.show=!0,g.missing=!1;const t=Math.random()<.5;o?t?p.missing=!0:m.missing=!0:t?a.missing=!0:l.missing=!0;break;case"reversePerimeter":v.show=!0,v.missing=!1,h([a,d,u]).missing=!0;break;case"pythagorasArea":if(!o)throw new Error("Should have RA triangle here");g.show=!0,g.missing=!0,h([p,m]).show=!1;break;case"pythagorasPerimeter":if(!o)throw new Error("Should have RA triangle here");v.show=!0,v.missing=!0,h([p,m,f]).show=!1;break;case"pythagorasIsoscelesArea":default:g.show=!0,g.missing=!0,l.show=!1}return new ht(a,d,u,l,e,g,v)}))}}function lt(t){return t.s1===t.h||t.s2===t.h}class dt extends L{constructor(t,e,s,i,n,o){super(t,e),this.A=s,this.B=i,this.C=n,this.labels=null!=o?o:[]}render(){return ot(this,void 0,void 0,(function*(){const t=m("div","loader",this.DOM);if(void 0===this.A&&(yield this.init()),!(this.A&&this.B&&this.C&&this.ht))throw new Error("Intialisation failed. Points are: "+[this.A,this.B,this.C,this.ht]);if(this.data instanceof Promise)throw new Error("Initialisation failed: data is still a Promise");const e=this.canvas.getContext("2d");if(null===e)throw new Error("Could not get canvas context");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.setLineDash([]),e.beginPath(),e.moveTo(this.A.x,this.A.y),e.lineTo(this.B.x,this.B.y),e.lineTo(this.C.x,this.C.y),e.lineTo(this.A.x,this.A.y),e.stroke(),e.fillStyle="LightGrey",e.fill(),e.closePath(),this.data.height.show&&(e.beginPath(),et(e,C.mean(this.C,this.ht).moveToward(this.C,15),this.C,10),et(e,C.mean(this.C,this.ht).moveToward(this.ht,15),this.ht,10),e.stroke(),e.closePath()),(this.data.isRightAngled()||this.data.height.show)&&(e.beginPath(),this.A.equals(this.ht)?st(e,this.B,this.ht,this.C,15):st(e,this.A,this.ht,this.C,15),e.stroke(),e.closePath()),this.data.height.show&&this.overhangRight&&(e.beginPath(),e.setLineDash([5,3]),e.moveTo(this.B.x,this.B.y),e.lineTo(this.ht.x,this.ht.y),e.stroke(),e.closePath()),this.data.height.show&&this.overhangLeft&&(e.beginPath(),e.setLineDash([5,3]),e.moveTo(this.A.x,this.A.y),e.lineTo(this.ht.x,this.ht.y),e.stroke(),e.closePath()),this.renderLabels(),t.remove()}))}init(){var t,e,s,i;return ot(this,void 0,void 0,(function*(){this.data=yield this.data;const n=this.data.height.val,o=this.data.base.val,a=this.data.side1.val,r=this.data.side2.val;this.A=new C(0,n),this.B=new C(o,n),this.C=new C((o*o+a*a-r*r)/(2*o),0),this.ht=new C(this.C.x,this.A.y),this.overhangRight=!1,this.overhangLeft=!1,this.C.x>this.B.x&&(this.overhangRight=!0),this.C.x<this.A.x&&(this.overhangLeft=!0),this.rotation=null!==(t=this.rotation)&&void 0!==t?t:2*Math.PI*Math.random(),[this.A,this.B,this.C,this.ht].forEach(t=>t.rotate(this.rotation)),C.scaleToFit([this.A,this.B,this.C,this.ht],this.width,this.height,80);const h=[[this.A,this.B,this.data.base],[this.C,this.A,this.data.side1],[this.B,this.C,this.data.side2]];this.ht.equals(this.B)?h.push([this.ht,this.C,this.data.height]):h.push([this.C,this.ht,this.data.height]);for(let t=0;t<4;t++){if(!h[t][2].show)continue;const s=20;let i=C.mean(h[t][0],h[t][1]);const n=C.unitVector(h[t][0],h[t][1]);(t<3||this.data.isRightAngled())&&i.translate(-n.y*s,n.x*s);const o=null!==(e=h[t][2].label)&&void 0!==e?e:h[t][2].val.toString(),a=h[t][2].missing?"?":o,r="normal",l=h[t][2].missing?"answer":"normal";this.labels.push({pos:i,texta:o,textq:a,text:a,stylea:l,styleq:r,style:r})}let l=0;if(this.data.area.show){const t=null!==(s=this.data.area.label)&&void 0!==s?s:this.data.area.val.toString(),e=this.data.area.missing?"?":t,i="extra-info",n=this.data.area.missing?"extra-answer":"extra-info";this.labels.push({texta:"Area = "+t,textq:"Area = "+e,text:"Area = "+e,styleq:i,stylea:n,style:i,pos:new C(10,this.height-10-15*l)}),l++}if(this.data.perimeter.show){const t=null!==(i=this.data.perimeter.label)&&void 0!==i?i:this.data.perimeter.val.toString(),e=this.data.perimeter.missing?"?":t,s="extra-info",n=this.data.perimeter.missing?"extra-answer":"extra-info";this.labels.push({pos:new C(10,this.height-10-20*l),texta:"Perimeter = "+t,textq:"Perimeter = "+e,text:"Perimeter = "+e,styleq:s,stylea:n,style:s})}}))}static fromAsyncData(t,e){return new this(t,e)}}class ct extends M{constructor(t,e){super(t,e)}static random(t,e){const s=ht.random(t);return new this(s,dt.fromAsyncData(s,e))}static get commandWord(){return"Find the missing values"}}const ut=[{id:"algebraic-fraction",title:"Simplify algebraic fractions",class:class extends y{constructor(t){super(t);const e=Object.assign({},{difficulty:2},t);var s,i,n,a,r,h,l,d,c,u,p,m,f;switch(e.difficulty){case 1:u=1,p=1,m=1,f=6;break;case 2:u=1,p=1,m=-6,f=6;break;case 3:u=1,p=3,m=-5,f=5;break;case 4:default:u=-3,p=3,m=-5,f=5}for(;!s&&!i||!n&&!a||!r&&!h||b(s,i,n,a);)s=o(u,p),n=o(u,p),r=o(u,p),i=o(m,f),a=o(m,f),h=o(m,f);n<=0&&a<=0&&(n=-n,a=-a,s=-s,i=-i),l=n*r,d=n*h+a*r,c=a*h;const g=`\\frac{${x(s*r,s*h+i*r,i*h)}}{${x(l,d,c)}}`;e.useCommandWord?this.questionLaTeX="\\text{Simplify} "+g:this.questionLaTeX=g,this.answerLaTeX=0===n&&1===a?x(0,s,i):`\\frac{${x(0,s,i)}}{${x(0,n,a)}}`,this.answerLaTeX="= "+this.answerLaTeX}static get commandWord(){return"Simplify"}}},{id:"add-a-zero",title:"Multiply by 10 (honest!)",class:P},{id:"integer-add",title:"Add integers (v simple)",class:class extends y{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label;const s=o(10,1e3),i=o(10,1e3),n=s+i;this.questionLaTeX=s+" + "+i,this.answerLaTeX="= "+n,this.render()}static get commandWord(){return"Evaluate"}}},{id:"missing-angles",title:"Missing angles",class:tt},{id:"area-perimter",title:"Area and perimeter of shapes",class:class extends w{constructor(t){super(),this.question=t,this.DOM=t.DOM}static random(t){const e=h(t.shapes);return this.randomFromDifficulty(1,e,t.questionTypesSimple)}static randomFromDifficulty(t,e,s){const i={questionType:h(s),dp:0,noDistractors:!0},n={};let o;switch(e){case"rectangle":o=nt.random(i,n);break;case"triangle":default:o=ct.random(i,n)}return new this(o)}render(){this.question.render()}showAnswer(){this.question.showAnswer()}hideAnswer(){this.question.hideAnswer()}toggleAnswer(){this.question.toggleAnswer()}static get optionsSpec(){return[{id:"shapes",type:"select-inclusive",selectOptions:[{id:"rectangle",title:"Rectangle"},{id:"triangle",title:"Triangle"}],default:["rectangle"],title:"Shapes"},{id:"questionTypesSimple",type:"select-inclusive",selectOptions:[{id:"area",title:"Area"},{id:"perimeter",title:"Perimeter"}],default:["area","perimeter"],title:"Type of question"}]}static get commandWord(){return"Find the missing value"}}},{id:"equation-of-line",title:"Equation of a line (from two points)",class:class extends y{constructor(t){super(t);const e=Object.assign({},{difficulty:2},t),s=Math.ceil(e.difficulty/2);let i,n,a,r,h,l,d,c,u,p;switch(s){case 1:case 2:case 3:if(d=s<3?1:-5,c=5,u=s<2?0:-10,p=10,i=o(d,5),n=o(u,10),a=s<3?o(0,10):o(-15,15),r=i*a+n,s<3)h=o(a+1,15);else for(h=a;h===a;)h=o(-15,15);l=i*h+n;break;case 4:default:{const t=o(1,5),e=o(-5,5);i=new B(e,t),a=new B(o(-10,10)),r=new B(o(-10,10)),n=new B(r).sub(i.mul(a)),h=a.add(o(1,5)*i.d),l=i.mul(h).add(n);break}}const m=0===i||i.equals&&i.equals(0)?"":1===i||i.equals&&i.equals(1)?"x":-1===i||i.equals&&i.equals(-1)?"-x":i.toLatex?i.toLatex()+"x":i+"x",f=0===n||n.equals&&n.equals(0)?"":n<0?" - "+(n.neg?n.neg().toLatex():-n):n.toLatex?" + "+n.toLatex():" + "+n;this.questionLaTeX="("+a+", "+r+")\\text{ and }("+h+", "+l+")",this.answerLaTeX="y = "+m+f}static get commandWord(){return"Find the equation of the line through"}}},{id:"arithmagon-add",title:"Arithmagons",class:T},{id:"test",title:"Test questions",class:N}];function pt(t){for(let e=0;e<ut.length;e++)if(ut[e].id===t)return ut[e].class;return null}function mt(t){return null===pt(t)?"":pt(t).commandWord}var ft=A((function(t,e){t.exports=function(){var t=!1;function e(t){this.opts=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}({},{onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["overlay","button","escape"]},t),this.init()}function s(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}return e.prototype.init=function(){if(!this.modal)return function(){this.modal=document.createElement("div"),this.modal.classList.add("tingle-modal"),0!==this.opts.closeMethods.length&&-1!==this.opts.closeMethods.indexOf("overlay")||this.modal.classList.add("tingle-modal--noOverlayClose"),this.modal.style.display="none",this.opts.cssClass.forEach((function(t){"string"==typeof t&&this.modal.classList.add(t)}),this),-1!==this.opts.closeMethods.indexOf("button")&&(this.modalCloseBtn=document.createElement("button"),this.modalCloseBtn.type="button",this.modalCloseBtn.classList.add("tingle-modal__close"),this.modalCloseBtnIcon=document.createElement("span"),this.modalCloseBtnIcon.classList.add("tingle-modal__closeIcon"),this.modalCloseBtnIcon.innerHTML='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.3 9.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3L5 6.4l3.3 3.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L6.4 5l3.3-3.3c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0L5 3.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L3.6 5 .3 8.3c-.4.4-.4 1 0 1.4z" fill="#000" fill-rule="nonzero"/></svg>',this.modalCloseBtnLabel=document.createElement("span"),this.modalCloseBtnLabel.classList.add("tingle-modal__closeLabel"),this.modalCloseBtnLabel.innerHTML=this.opts.closeLabel,this.modalCloseBtn.appendChild(this.modalCloseBtnIcon),this.modalCloseBtn.appendChild(this.modalCloseBtnLabel)),this.modalBox=document.createElement("div"),this.modalBox.classList.add("tingle-modal-box"),this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("tingle-modal-box__content"),this.modalBox.appendChild(this.modalBoxContent),-1!==this.opts.closeMethods.indexOf("button")&&this.modal.appendChild(this.modalCloseBtn),this.modal.appendChild(this.modalBox)}.call(this),function(){this._events={clickCloseBtn:this.close.bind(this),clickOverlay:function(t){var e=this.modal.offsetWidth-this.modal.clientWidth,s=t.clientX>=this.modal.offsetWidth-15,i=this.modal.scrollHeight!==this.modal.offsetHeight;"MacIntel"===navigator.platform&&0==e&&s&&i||-1!==this.opts.closeMethods.indexOf("overlay")&&!function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"tingle-modal")&&t.clientX<this.modal.clientWidth&&this.close()}.bind(this),resize:this.checkOverflow.bind(this),keyboardNav:function(t){-1!==this.opts.closeMethods.indexOf("escape")&&27===t.which&&this.isOpen()&&this.close()}.bind(this)},-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.addEventListener("click",this._events.clickCloseBtn),this.modal.addEventListener("mousedown",this._events.clickOverlay),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}.call(this),document.body.appendChild(this.modal,document.body.firstChild),this.opts.footer&&this.addFooter(),this},e.prototype._busy=function(e){t=e},e.prototype._isBusy=function(){return t},e.prototype.destroy=function(){null!==this.modal&&(this.isOpen()&&this.close(!0),function(){-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},e.prototype.isOpen=function(){return!!this.modal.classList.contains("tingle-modal--visible")},e.prototype.open=function(){if(!this._isBusy()){this._busy(!0);var t=this;return"function"==typeof t.opts.beforeOpen&&t.opts.beforeOpen(),this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),this._scrollPosition=window.pageYOffset,document.body.classList.add("tingle-enabled"),document.body.style.top=-this._scrollPosition+"px",this.setStickyFooter(this.opts.stickyFooter),this.modal.classList.add("tingle-modal--visible"),"function"==typeof t.opts.onOpen&&t.opts.onOpen.call(t),t._busy(!1),this.checkOverflow(),this}},e.prototype.close=function(t){if(!this._isBusy()){if(this._busy(!0),"function"==typeof this.opts.beforeClose&&!this.opts.beforeClose.call(this))return void this._busy(!1);document.body.classList.remove("tingle-enabled"),document.body.style.top=null,window.scrollTo({top:this._scrollPosition,behavior:"instant"}),this.modal.classList.remove("tingle-modal--visible");var e=this;e.modal.style.display="none","function"==typeof e.opts.onClose&&e.opts.onClose.call(this),e._busy(!1)}},e.prototype.setContent=function(t){return"string"==typeof t?this.modalBoxContent.innerHTML=t:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(t)),this.isOpen()&&this.checkOverflow(),this},e.prototype.getContent=function(){return this.modalBoxContent},e.prototype.addFooter=function(){return function(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("tingle-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter)}.call(this),this},e.prototype.setFooterContent=function(t){return this.modalBoxFooter.innerHTML=t,this},e.prototype.getFooterContent=function(){return this.modalBoxFooter},e.prototype.setStickyFooter=function(t){return this.isOverflow()||(t=!1),t?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("tingle-modal-box__footer--sticky"),s.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("tingle-modal-box__footer--sticky"))),this},e.prototype.addFooterBtn=function(t,e,s){var i=document.createElement("button");return i.innerHTML=t,i.addEventListener("click",s),"string"==typeof e&&e.length&&e.split(" ").forEach((function(t){i.classList.add(t)})),this.modalBoxFooter.appendChild(i),i},e.prototype.resize=function(){console.warn("Resize is deprecated and will be removed in version 1.0")},e.prototype.isOverflow=function(){return window.innerHeight<=this.modalBox.clientHeight},e.prototype.checkOverflow=function(){this.modal.classList.contains("tingle-modal--visible")&&(this.isOverflow()?this.modal.classList.add("tingle-modal--overflow"):this.modal.classList.remove("tingle-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(s.call(this),this.setStickyFooter(!0)))},{modal:e}}()}));window.SHOW_DIFFICULTY=!1,m("div","overlay hidden",document.body).addEventListener("click",vt);class gt{constructor(t){this.questions=[],this.topics=[],this.optionsSets={},this.qNumber=t||1,this.answered=!1,this.commandWord="",this.useCommandWord=!0,this.n=8,this._build()}_build(){this.outerBox=m("div","question-outerbox"),this.headerBox=m("div","question-headerbox",this.outerBox),this.displayBox=m("div","question-displaybox",this.outerBox),this._buildOptionsBox(),this._buildTopicChooser()}_buildOptionsBox(){const t=m("span",void 0,this.headerBox);this.topicChooserButton=m("span","topic-chooser button",t),this.topicChooserButton.innerHTML="Choose topic",this.topicChooserButton.addEventListener("click",()=>this.chooseTopics());const e=m("span",void 0,this.headerBox);e.append("Difficulty: ");const s=m("span","slider-outer",e);this.difficultySliderElement=m("input",void 0,s);const i=m("span",void 0,this.headerBox);i.append("Number of questions: ");const n=m("input","n-questions",i);n.type="number",n.min="1",n.value="8",n.addEventListener("change",()=>{this.n=parseInt(n.value)}),this.generateButton=m("button","generate-button button",this.headerBox),this.generateButton.disabled=!0,this.generateButton.innerHTML="Generate!",this.generateButton.addEventListener("click",()=>this.generateAll())}_initSlider(){this.difficultySlider=new t({target:this.difficultySliderElement,values:{min:1,max:10},range:!0,set:[2,6],step:1,tooltip:!1,scale:!0,labels:!0})}_buildTopicChooser(){const t=ut.map(t=>({id:t.id,title:t.title})),e=[];t.forEach(t=>{e.push({title:t.title,id:t.id,type:"bool",default:!1,swapLabel:!0})}),this.topicsOptions=new g(e),this.topicsModal=new ft.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close",onClose:()=>{this.updateTopics()}}),this.topicsModal.addFooterBtn("OK","button modal-button",()=>{this.topicsModal.close()}),this.topicsOptions.renderIn(this.topicsModal.getContent());Array.from(this.topicsModal.getContent().getElementsByTagName("li")).forEach(t=>{const e=t.dataset.optionId;if(void 0!==e&&(pt(s=e).optionsSpec&&pt(s).optionsSpec.length>0)){const s=m("div","icon-button extra-options-button",t);this._buildTopicOptions(e,s)}var s})}_buildTopicOptions(t,e){const s=function(t){const e=pt(t).optionsSpec||[];return new g(e)}(t);this.optionsSets[t]=s;const i=new ft.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close"});i.addFooterBtn("OK","button modal-button",()=>{i.close()}),s.renderIn(i.getContent()),e.addEventListener("click",()=>{i.open()})}chooseTopics(){this.topicsModal.open()}updateTopics(){const t=function(t){const e=[];for(const s in t)t[s]&&e.push(s);return e}(this.topicsOptions.options);let e;if(this.topics=t,0===t.length)e="Choose topic",this.generateButton.disabled=!0;else{e=function(t){return ut.find(e=>e.id===t).title}(t[0]),this.generateButton.disabled=!1}t.length>1&&(e+=" +"+(t.length-1)),this.topicChooserButton.innerHTML=e}setCommandWord(){let t=mt(this.topics[0]),e=!0;for(let s=1;s<this.topics.length;s++)if(mt(this.topics[s])!==t){t="",e=!1;break}this.commandWord=t,this.useCommandWord=e}generateAll(){this.displayBox.innerHTML="",this.questions=[],this.setCommandWord();m("p","katex mainq",this.displayBox).innerHTML=`${this.qNumber}. ${this.commandWord}`,this.answerButton=m("p","button show-answers",this.displayBox),this.answerButton.addEventListener("click",()=>{this.toggleAnswers()}),this.answerButton.innerHTML="Show answers";const t=this.difficultySlider.getValueL(),e=this.difficultySlider.getValueR();for(let s=0;s<this.n;s++){const i=m("div","question-container",this.displayBox);i.dataset.question_index=s+"",this.questions[s]||(this.questions[s]={container:i});const n=t+Math.floor(s*(e-t+1)/this.n);this.generate(s,n)}}generate(t,e,s){s=s||h(this.topics);const i={label:"",difficulty:e,useCommandWord:!1};this.optionsSets[s]&&Object.assign(i,this.optionsSets[s].options);const n=function(t,e){const s=pt(t);let i;return i=s.random?s.random(e):new s(e),i}(s,i);if(!this.questions[t])throw new Error("question not made");this.questions[t].question=n,this.questions[t].topicId=s;const o=this.questions[t].container;o.innerHTML="";let a=function(t){return t<26?String.fromCharCode(97+t):t<52?String.fromCharCode(65+t-26):String.fromCharCode(945+t-52)}(t)+")";window.SHOW_DIFFICULTY&&(a+=i.difficulty),this.useCommandWord?o.classList.remove("individual-command-word"):(a+=" "+mt(s),o.classList.add("individual-command-word"));m("div","question-number katex",o).innerHTML=a,o.appendChild(n.getDOM()),n.render();const r=m("div","question-actions hidden",o),l=m("div","question-refresh icon-button",r);m("div","question-answer icon-button",r).addEventListener("click",()=>{n.toggleAnswer(),vt()}),l.addEventListener("click",()=>{this.generate(t,e),vt()}),o.addEventListener("click",e=>{(function(t,e){let s=!1;for(;t&&t!==document;t=t.parentNode)t.classList.contains(e)&&(s=!0);return s})(e.target,"question-actions")||this.showQuestionActions(t)})}toggleAnswers(){this.answered?this.questions.forEach(t=>{t.question&&t.question.hideAnswer(),this.answered=!1,this.answerButton.innerHTML="Show answers"}):this.questions.forEach(t=>{t.question&&t.question.showAnswer(),this.answered=!0,this.answerButton.innerHTML="Hide answers"})}adjustGridWidth(){}showQuestionActions(t){vt();const e=this.questions[t].container,s=e.querySelector(".question-actions"),i=document.querySelector(".overlay");null!==i&&i.classList.remove("hidden"),s.classList.remove("hidden"),s.style.left=e.offsetWidth/2-s.offsetWidth/2+"px",s.style.top=e.offsetHeight/2-s.offsetHeight/2+"px"}appendTo(t){t.appendChild(this.outerBox),this._initSlider()}appendBefore(t,e){t.insertBefore(this.outerBox,e),this._initSlider()}}function vt(){document.querySelectorAll(".question-actions").forEach(t=>{t.classList.add("hidden")});const t=document.querySelector(".overlay");if(null===t)throw new Error("Could not find overlay when hiding actions");t.classList.add("hidden")}document.addEventListener("DOMContentLoaded",()=>{const t=new gt;t.appendTo(document.body),t.chooseTopics()})}();
