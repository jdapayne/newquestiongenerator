!function(){"use strict";var t=function(t){for(var e in this.input=null,this.inputDisplay=null,this.slider=null,this.sliderWidth=0,this.sliderLeft=0,this.pointerWidth=0,this.pointerR=null,this.pointerL=null,this.activePointer=null,this.selected=null,this.scale=null,this.step=0,this.tipL=null,this.tipR=null,this.timeout=null,this.valRange=!1,this.values={start:null,end:null},this.conf={target:null,values:null,set:null,range:!1,width:null,scale:!0,labels:!0,tooltip:!0,step:null,disabled:!1,onChange:null},this.cls={container:"rs-container",background:"rs-bg",selected:"rs-selected",pointer:"rs-pointer",scale:"rs-scale",noscale:"rs-noscale",tip:"rs-tooltip"},this.conf)Object.prototype.hasOwnProperty.call(t,e)&&(this.conf[e]=t[e]);this.init()};t.prototype.init=function(){return"object"==typeof this.conf.target?this.input=this.conf.target:this.input=document.getElementById(this.conf.target.replace("#","")),this.input?(this.inputDisplay=getComputedStyle(this.input,null).display,this.input.style.display="none",this.valRange=!(this.conf.values instanceof Array),!this.valRange||Object.prototype.hasOwnProperty.call(this.conf.values,"min")&&Object.prototype.hasOwnProperty.call(this.conf.values,"max")?this.createSlider():console.log("Missing min or max value...")):console.log("Cannot find target element...")},t.prototype.createSlider=function(){return this.slider=s("div",this.cls.container),this.slider.innerHTML='<div class="rs-bg"></div>',this.selected=s("div",this.cls.selected),this.pointerL=s("div",this.cls.pointer,["dir","left"]),this.scale=s("div",this.cls.scale),this.conf.tooltip&&(this.tipL=s("div",this.cls.tip),this.tipR=s("div",this.cls.tip),this.pointerL.appendChild(this.tipL)),this.slider.appendChild(this.selected),this.slider.appendChild(this.scale),this.slider.appendChild(this.pointerL),this.conf.range&&(this.pointerR=s("div",this.cls.pointer,["dir","right"]),this.conf.tooltip&&this.pointerR.appendChild(this.tipR),this.slider.appendChild(this.pointerR)),this.input.parentNode.insertBefore(this.slider,this.input.nextSibling),this.conf.width&&(this.slider.style.width=parseInt(this.conf.width)+"px"),this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.pointerWidth=this.pointerL.clientWidth,this.conf.scale||this.slider.classList.add(this.cls.noscale),this.setInitialValues()},t.prototype.setInitialValues=function(){if(this.disabled(this.conf.disabled),this.valRange&&(this.conf.values=n(this.conf)),this.values.start=0,this.values.end=this.conf.range?this.conf.values.length-1:0,this.conf.set&&this.conf.set.length&&o(this.conf)){var t=this.conf.set;this.conf.range?(this.values.start=this.conf.values.indexOf(t[0]),this.values.end=this.conf.set[1]?this.conf.values.indexOf(t[1]):null):this.values.end=this.conf.values.indexOf(t[0])}return this.createScale()},t.prototype.createScale=function(t){this.step=this.sliderWidth/(this.conf.values.length-1);for(var e=0,i=this.conf.values.length;e<i;e++){var n=s("span"),o=s("ins");n.appendChild(o),this.scale.appendChild(n),n.style.width=e===i-1?0:this.step+"px",this.conf.labels?o.innerHTML=this.conf.values[e]:0!==e&&e!==i-1||(o.innerHTML=this.conf.values[e]),o.style.marginLeft=o.clientWidth/2*-1+"px"}return this.addEvents()},t.prototype.updateScale=function(){this.step=this.sliderWidth/(this.conf.values.length-1);for(var t=this.slider.querySelectorAll("span"),e=0,s=t.length;e<s-1;e++)t[e].style.width=this.step+"px";return this.setValues()},t.prototype.addEvents=function(){var t=this.slider.querySelectorAll("."+this.cls.pointer),e=this.slider.querySelectorAll("span");i(document,"mousemove touchmove",this.move.bind(this)),i(document,"mouseup touchend touchcancel",this.drop.bind(this));for(let e=0,s=t.length;e<s;e++)i(t[e],"mousedown touchstart",this.drag.bind(this));for(let t=0,s=e.length;t<s;t++)i(e[t],"click",this.onClickPiece.bind(this));return window.addEventListener("resize",this.onResize.bind(this)),this.setValues()},t.prototype.drag=function(t){if(t.preventDefault(),!this.conf.disabled){var e=t.target.getAttribute("data-dir");return"left"===e&&(this.activePointer=this.pointerL),"right"===e&&(this.activePointer=this.pointerR),this.slider.classList.add("sliding")}},t.prototype.move=function(t){if(this.activePointer&&!this.conf.disabled){var e=("touchmove"===t.type?t.touches[0].clientX:t.pageX)-this.sliderLeft-this.pointerWidth/2;return(e=Math.round(e/this.step))<=0&&(e=0),e>this.conf.values.length-1&&(e=this.conf.values.length-1),this.conf.range?(this.activePointer===this.pointerL&&(this.values.start=e),this.activePointer===this.pointerR&&(this.values.end=e)):this.values.end=e,this.setValues()}},t.prototype.drop=function(){this.activePointer=null},t.prototype.setValues=function(t,e){var s=this.conf.range?"start":"end";return t&&this.conf.values.indexOf(t)>-1&&(this.values[s]=this.conf.values.indexOf(t)),e&&this.conf.values.indexOf(e)>-1&&(this.values.end=this.conf.values.indexOf(e)),this.conf.range&&this.values.start>this.values.end&&(this.values.start=this.values.end),this.pointerL.style.left=this.values[s]*this.step-this.pointerWidth/2+"px",this.conf.range?(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.start],this.tipR.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.start]+","+this.conf.values[this.values.end],this.pointerR.style.left=this.values.end*this.step-this.pointerWidth/2+"px"):(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.end]),this.values.end>this.conf.values.length-1&&(this.values.end=this.conf.values.length-1),this.values.start<0&&(this.values.start=0),this.selected.style.width=(this.values.end-this.values.start)*this.step+"px",this.selected.style.left=this.values.start*this.step+"px",this.onChange()},t.prototype.onClickPiece=function(t){if(!this.conf.disabled){var e=Math.round((t.clientX-this.sliderLeft)/this.step);return e>this.conf.values.length-1&&(e=this.conf.values.length-1),e<0&&(e=0),this.conf.range&&e-this.values.start<=this.values.end-e?this.values.start=e:this.values.end=e,this.slider.classList.remove("sliding"),this.setValues()}},t.prototype.onChange=function(){var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){if(t.conf.onChange&&"function"==typeof t.conf.onChange)return t.conf.onChange(t.input.value)}),500)},t.prototype.onResize=function(){return this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.updateScale()},t.prototype.disabled=function(t){this.conf.disabled=t,this.slider.classList[t?"add":"remove"]("disabled")},t.prototype.getValue=function(){return[this.conf.values[this.values.start],this.conf.values[this.values.end]]},t.prototype.getValueL=function(){return this.conf.values[this.values.start]},t.prototype.getValueR=function(){return this.conf.values[this.values.end]},t.prototype.destroy=function(){this.input.style.display=this.inputDisplay,this.slider.remove()};var s=function(t,e,s){var i=document.createElement(t);return e&&(i.className=e),s&&2===s.length&&i.setAttribute("data-"+s[0],s[1]),i},i=function(t,e,s){for(var i=e.split(" "),n=0,o=i.length;n<o;n++)t.addEventListener(i[n],s)},n=function(t){var e=[],s=t.values.max-t.values.min;if(!t.step)return console.log("No step defined..."),[t.values.min,t.values.max];for(var i=0,n=s/t.step;i<n;i++)e.push(t.values.min+i*t.step);return e.indexOf(t.values.max)<0&&e.push(t.values.max),e},o=function(t){return!t.set||t.set.length<1||t.values.indexOf(t.set[0])<0?null:!t.range||!(t.set.length<2||t.values.indexOf(t.set[1])<0)||null};function a(t,e,s){return s||(s=Math.random),t+Math.floor(s()*(e-t+1))}function r(t,e,s){const i=[];for(let n=t;n<e+1;n++)s(n)&&i.push(n);if(i===[])throw new Error("overfiltered");return i[a(0,i.length-1)]}function l(t,e){if(0===[...t].length)throw new Error("empty array");e||(e=Math.random);const s=a(0,(t.length||t.size)-1,e);return[...t][s]}function h(t){return Math.sin(t*Math.PI/180)}function d(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function c(t,e,s){const i=document.createElement(t);return e&&(i.className=e),s&&s.appendChild(i),i}function u(t,e,s,i,n){const o=Math.hypot(i-e,n-s),a=(s-n)/o,r=(i-e)/o,l=(e+i)/2,h=(s+n)/2;t.moveTo(e,s),t.lineTo(i,n),t.moveTo(l+5*a,h+5*r),t.lineTo(l-5*a,h-5*r),t.moveTo(i,n)}class p{constructor(t,e){this.optionSpec=t,this.options={},this.optionSpec.forEach(t=>{"heading"!==t.type&&"column-break"!==t.type&&(this.options[t.id]=t.default)}),this.template=e,this.globalId=p.getId()}updateStateFromUI(t){if("string"==typeof t&&!(t=this.optionsSpec.find(e=>e.id===t)))throw new Error(`no option with id '${t}'`);if(!t.element)throw new Error(`option ${t.id} doesn't have a UI element`);switch(t.type){case"int":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=Number(e.value);break}case"bool":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=e.checked;break}case"select-exclusive":this.options[t.id]=t.element.querySelector("input:checked").value;break;case"select-inclusive":this.options[t.id]=Array.from(t.element.querySelectorAll("input:checked"),t=>t.value);break;default:throw new Error(`option with id ${t.id} has unrecognised option type ${t.type}`)}}renderIn(t){const e=document.createElement("ul");e.classList.add("options-list"),this.optionSpec.forEach(t=>{const s=document.createElement("li");if(s.dataset.optionId=t.id,e.append(s),"column-break"===t.type)s.classList.add("column-break");else if("heading"===t.type)s.append(t.title),s.classList.add("options-heading");else if("int"===t.type||"bool"===t.type){const e=document.createElement("label");s.append(e),t.swapLabel||e.append(t.title+": ");const i=document.createElement("input");switch(t.type){case"int":i.type="number",i.min=t.min,i.max=t.max,i.value=t.default;break;case"bool":i.type="checkbox",i.checked=t.default;break;default:throw new Error("unknown option type "+t.type)}i.classList.add("option"),e.append(i),t.swapLabel&&e.append(" "+t.title)}else{if("select-inclusive"!==t.type&&"select-exclusive"!==t.type)throw new Error(`unknown option type '${t.type}'`);{s.append(t.title+": ");const e=c("ul","options-sublist",s);t.vertical&&e.classList.add("options-sublist-vertical"),t.selectOptions.forEach(s=>{const i=c("li",null,e),n=c("label",null,i),o=document.createElement("input");o.type="select-exclusive"===t.type?"radio":"checkbox",o.name=this.globalId+"-"+t.id,o.value=s.id,"select-inclusive"===t.type?o.checked=t.default.includes(s.id):o.checked=t.default===s.id,n.append(o),o.classList.add("option"),n.append(s.title)})}}s.addEventListener("change",e=>this.updateStateFromUI(t)),t.element=s}),t.append(e)}}p.idCounter=0,p.getId=function(){if(p.idCounter>=676)throw new Error("Too many options objects!");const t=String.fromCharCode(97+~~(p.idCounter/26))+String.fromCharCode(p.idCounter%26+97);return p.idCounter+=1,t},p.demoSpec=[{title:"Difficulty",id:"difficulty",type:"int",min:1,max:10,default:5},{title:"Type",id:"type",type:"select-exclusive",selectOptions:[{title:"Rectangle",id:"rectangle"},{title:"Triangle",id:"triangle"},{title:"Squoval",id:"squoval"}],default:"rectangle"},{title:"A heading",type:"heading"},{title:"Shape",id:"shape",type:"select-inclusive",selectOptions:[{title:"Rectangle shape thing",id:"rectangle"},{title:"Triangle shape thing",id:"triangle"},{title:"Squoval shape long",id:"squoval"}],default:["rectangle","squoval"],vertical:!0},{type:"column-break"},{type:"heading",title:"A new column"},{title:"Do something",id:"something",type:"bool",default:!0,swapLabel:!0}];class f{constructor(t){this.DOM=document.createElement("div"),this.DOM.className="question-div",this.answered=!1}getDOM(){return this.DOM}showAnswer(){this.answered=!0}hideAnswer(){this.answered=!1}toggleAnswer(){this.answered?this.hideAnswer():this.showAnswer()}static get commandWord(){return""}}class m extends f{constructor(t){super();const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label,this.questionLaTeX="2+2",this.answerLaTeX="=5",this.questionp=document.createElement("p"),this.answerp=document.createElement("p"),this.questionp.className="question",this.answerp.className="answer",this.answerp.classList.add("hidden"),this.DOM.appendChild(this.questionp),this.DOM.appendChild(this.answerp)}render(){var t=this.label?"\\text{"+this.label+") }":"";katex.render(t+this.questionLaTeX,this.questionp,{displayMode:!0,strict:"ignore"}),katex.render(this.answerLaTeX,this.answerp,{displayMode:!0})}getDOM(){return this.DOM}showAnswer(){this.answerp.classList.remove("hidden"),this.answered=!0}hideAnswer(){this.answerp.classList.add("hidden"),this.answered=!1}}function v(t,e,s){return 0===t&&0===e&&0===s?"0":(0===t?"":1===t?"x^2":-1===t?"-x^2":t+"x^2")+(e<0?"-":0===t||0===e?"":"+")+(0===e?"":1===e||-1===e?"x":Math.abs(e)+"x")+(s<0?"-":0===t&&0===e||0===s?"":"+")+(0===s?"":Math.abs(s))}function g(t,e,s,i){var n=d(t,e);t/=n,e/=n;var o=d(s,i);s/=o,i/=o;var a=!1;return(d(n,o)>1||t===s&&e===i)&&(a=!0),a}class y{constructor(t,e){this.x=t,this.y=e}rotate(t){var e,s;return e=Math.cos(t)*this.x-Math.sin(t)*this.y,s=Math.sin(t)*this.x+Math.cos(t)*this.y,this.x=e,this.y=s,this}scale(t){return this.x=this.x*t,this.y=this.y*t,this}translate(t,e){return this.x+=t,this.y+=e,this}clone(){return new y(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}moveToward(t,e){const s=y.unitVector(this,t);return this.translate(s.x*e,s.y*e),this}static fromPolar(t,e){return new y(Math.cos(e)*t,Math.sin(e)*t)}static fromPolarDeg(t,e){return e=e*Math.PI/180,y.fromPolar(t,e)}static mean(...t){const e=t.map(t=>t.x).reduce((t,e)=>t+e),s=t.map(t=>t.y).reduce((t,e)=>t+e),i=t.length;return new y(e/i,s/i)}static inCenter(t,e,s){const i=y.distance(e,s),n=y.distance(t,s),o=y.distance(t,e),a=i+n+o,r=i*t.x+n*e.x+o*s.x,l=i*t.y+n*e.y+o*s.y;return new y(r/a,l/a)}static min(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0);return new y(e,s)}static max(t){const e=t.reduce((t,e)=>Math.max(t,e.x),-1/0),s=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new y(e,s)}static center(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0),i=t.reduce((t,e)=>Math.max(t,e.x),-1/0),n=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new y((i+e)/2,(n+s)/2)}static unitVector(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.hypot(s,i);return{x:s/n,y:i/n}}static distance(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}static repel(t,e,s,i){const n=Math.hypot(t.x-e.x,t.y-e.y);if(n>=s)return!1;const o=(i-n)/2;return t.moveToward(e,-o),e.moveToward(t,-o),!0}}class w extends f{constructor(t){super(t),delete this.DOM}getDOM(){return this.view.getDOM()}render(){this.view.render()}showAnswer(){super.showAnswer(),this.view.showAnswer()}hideAnswer(){super.hideAnswer(),this.view.hideAnswer()}}class x{constructor(t,e){e=Object.assign({},{width:250,height:250},e),this.width=e.width,this.height=e.height,this.data=t,this.labels=[],this.DOM=c("div","question-div"),this.canvas=c("canvas","question-canvas",this.DOM),this.canvas.width=this.width,this.canvas.height=this.height}getDOM(){return this.DOM}renderLabels(t){const e=this.DOM,s=e.getElementsByClassName("label");for(;s.length>0;)s[0].remove();this.labels.forEach(s=>{const i=document.createElement("div"),n=document.createElement("div");if(i.classList.add("label"),i.className+=" "+s.style,i.style.left=s.pos.x+"px",i.style.top=s.pos.y+"px",katex.render(s.text,n),i.appendChild(n),e.appendChild(i),n.offsetWidth/n.offsetHeight>2){console.log("removed space in "+s.text);const t=s.text.replace(/\+/,"\\!+\\!").replace(/-/,"\\!-\\!");katex.render(t,n)}const o=i.offsetWidth,a=i.offsetHeight;i.style.left=s.pos.x-o/2+"px",i.style.top=s.pos.y-a/2+"px",t&&(s.pos.x<this.canvas.width/2-5&&s.pos.x+o/2>this.canvas.width/2&&(i.style.left=this.canvas.width/2-o-3+"px",console.log(`nudged '${s.text}'`)),s.pos.x>this.canvas.width/2+5&&s.pos.x-o/2<this.canvas.width/2&&(i.style.left=this.canvas.width/2+3+"px",console.log(`nudged '${s.text}'`)))})}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!1)}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!1)}get allpoints(){return[]}scale(t){this.allpoints.forEach((function(e){e.scale(t)}))}rotate(t){return this.allpoints.forEach((function(e){e.rotate(t)})),t}translate(t,e){this.allpoints.forEach((function(s){s.translate(t,e)}))}randomRotate(){var t=2*Math.PI*Math.random();return this.rotate(t),t}scaleToFit(t,e,s){let i=y.min(this.allpoints),n=y.max(this.allpoints);const o=n.x-i.x,a=n.y-i.y;this.scale(Math.min((t-s)/o,(e-s)/a)),i=y.min(this.allpoints),n=y.max(this.allpoints);const r=y.mean([i,n]);this.translate(t/2-r.x,e/2-r.y)}}function b(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C,L,M=b((function(t,e){
/**
   * @license Fraction.js v4.0.9 09/09/2015
   * http://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2015, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **/
!function(s){var i={s:1,n:0,d:1};function n(t){function e(){var e=Error.apply(this,arguments);e.name=this.name=t,this.stack=e.stack,this.message=e.message}function s(){}return s.prototype=Error.prototype,e.prototype=new s,e}var o=c.DivisionByZero=n("DivisionByZero"),a=c.InvalidParameter=n("InvalidParameter");function r(t,e){return isNaN(t=parseInt(t,10))&&l(),t*e}function l(){throw new a}var h=function(t,e){var s,n=0,a=1,h=1,d=0,c=0,u=0,p=1,f=1,m=0,v=1,g=1,y=1,w=1e7;if(null==t);else if(void 0!==e)h=(n=t)*(a=e);else switch(typeof t){case"object":"d"in t&&"n"in t?(n=t.n,a=t.d,"s"in t&&(n*=t.s)):0 in t?(n=t[0],1 in t&&(a=t[1])):l(),h=n*a;break;case"number":if(t<0&&(h=t,t=-t),t%1==0)n=t;else if(t>0){for(t>=1&&(t/=f=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));v<=w&&y<=w;){if(t===(s=(m+g)/(v+y))){v+y<=w?(n=m+g,a=v+y):y>v?(n=g,a=y):(n=m,a=v);break}t>s?(m+=g,v+=y):(g+=m,y+=v),v>w?(n=g,a=y):(n=m,a=v)}n*=f}else(isNaN(t)||isNaN(e))&&(a=n=NaN);break;case"string":if(null===(v=t.match(/\d+|./g))&&l(),"-"===v[m]?(h=-1,m++):"+"===v[m]&&m++,v.length===m+1?c=r(v[m++],h):"."===v[m+1]||"."===v[m]?("."!==v[m]&&(d=r(v[m++],h)),(1+ ++m===v.length||"("===v[m+1]&&")"===v[m+3]||"'"===v[m+1]&&"'"===v[m+3])&&(c=r(v[m],h),p=Math.pow(10,v[m].length),m++),("("===v[m]&&")"===v[m+2]||"'"===v[m]&&"'"===v[m+2])&&(u=r(v[m+1],h),f=Math.pow(10,v[m+1].length)-1,m+=3)):"/"===v[m+1]||":"===v[m+1]?(c=r(v[m],h),p=r(v[m+2],1),m+=3):"/"===v[m+3]&&" "===v[m+1]&&(d=r(v[m],h),c=r(v[m+2],h),p=r(v[m+4],1),m+=5),v.length<=m){h=n=u+(a=p*f)*d+f*c;break}default:l()}if(0===a)throw new o;i.s=h<0?-1:1,i.n=Math.abs(n),i.d=Math.abs(a)};function d(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function c(t,e){if(!(this instanceof c))return new c(t,e);h(t,e),t=c.REDUCE?d(i.d,i.n):1,this.s=i.s,this.n=i.n/t,this.d=i.d/t}c.REDUCE=1,c.prototype={s:1,n:0,d:1,abs:function(){return new c(this.n,this.d)},neg:function(){return new c(-this.s*this.n,this.d)},add:function(t,e){return h(t,e),new c(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(t,e){return h(t,e),new c(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(t,e){return h(t,e),new c(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(t,e){return h(t,e),new c(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return new c(this)},mod:function(t,e){return isNaN(this.n)||isNaN(this.d)?new c(NaN):void 0===t?new c(this.s*this.n%this.d,1):(h(t,e),0===i.n&&0===this.d&&c(0,0),new c(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d))},gcd:function(t,e){return h(t,e),new c(d(i.n,this.n)*d(i.d,this.d),i.d*this.d)},lcm:function(t,e){return h(t,e),0===i.n&&0===this.n?new c:new c(i.n*this.n,d(i.n,this.n)*d(i.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new c(this.s*this.d,this.n)},pow:function(t){return t<0?new c(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new c(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,e){return h(t,e),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(t,e){h(t,e);var s=this.s*this.n*i.d-i.s*i.n*this.d;return(s>0)-(s<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var e=this.abs().toContinued();function s(t){return 1===t.length?new c(t[0]):s(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var i=0;i<e.length;i++){var n=s(e.slice(0,i+1));if(n.sub(this.abs()).abs().valueOf()<t)return n.mul(this.s)}return this},divisible:function(t,e){return h(t,e),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,s+=" ",i%=n),s+=i,s+="/",s+=n),s},toLatex:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,i%=n),s+="\\frac{",s+=i,s+="}{",s+=n,s+="}"),s},toContinued:function(){var t,e=this.n,s=this.d,i=[];if(isNaN(this.n)||isNaN(this.d))return i;do{i.push(Math.floor(e/s)),t=e%s,e=s,s=t}while(1!==e);return i},toString:function(t){var e,s=this.n,i=this.d;if(isNaN(s)||isNaN(i))return"NaN";c.REDUCE||(s/=e=d(s,i),i/=e),t=t||15;var n=function(t,e){for(;e%2==0;e/=2);for(;e%5==0;e/=5);if(1===e)return 0;for(var s=10%e,i=1;1!==s;i++)if(s=10*s%e,i>2e3)return 0;return i}(0,i),o=function(t,e,s){for(var i=1,n=function(t,e,s){for(var i=1;e>0;t=t*t%s,e>>=1)1&e&&(i=i*t%s);return i}(10,s,e),o=0;o<300;o++){if(i===n)return o;i=10*i%e,n=10*n%e}return 0}(0,i,n),a=-1===this.s?"-":"";if(a+=s/i|0,s%=i,(s*=10)&&(a+="."),n){for(var r=o;r--;)a+=s/i|0,s%=i,s*=10;for(a+="(",r=n;r--;)a+=s/i|0,s%=i,s*=10;a+=")"}else for(r=t;s&&r--;)a+=s/i|0,s%=i,s*=10;return a}},Object.defineProperty(e,"__esModule",{value:!0}),c.default=c,c.Fraction=c,t.exports=c}()}(L={path:C,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&L.path)}},L.exports),L.exports));class S{constructor(t,e){!isNaN(t)&&e instanceof Map?(this.c=t,this.vs=e):"string"==typeof t?this.initStr(t):isNaN(t)?(this.c=4,this.vs=new Map([["x",2],["y",1]])):(this.c=t,this.vs=new Map)}clone(){const t=new Map(this.vs);return new S(this.c,t)}mul(t){t instanceof S||(t=new S(t));const e=this.c*t.c;let s=new Map;return this.vs.forEach((e,i)=>{t.vs.has(i)?s.set(i,this.vs.get(i)+t.vs.get(i)):s.set(i,this.vs.get(i))}),t.vs.forEach((e,i)=>{s.has(i)||s.set(i,t.vs.get(i))}),s=new Map([...s.entries()].sort()),new S(e,s)}toLatex(){if(0===this.vs.size)return this.c.toString();let t=1===this.c?"":-1===this.c?"-":this.c.toString();return this.vs.forEach((e,s)=>{t+=1===e?s:s+"^"+e}),t}sort(){this.vs=new Map([...this.vs.entries()].sort())}cleanZeros(){this.vs.forEach((t,e)=>{0===t&&this.vs.delete(e)})}like(t){t instanceof S||(t=new S(t));let e=!0;return this.vs.forEach((s,i)=>{t.vs.has(i)&&t.vs.get(i)===s||(e=!1)}),t.vs.forEach((t,s)=>{this.vs.has(s)&&this.vs.get(s)===t||(e=!1)}),e}add(t,e){if(t instanceof S||(t=new S(t)),void 0===e&&(e=!0),e&&!this.like(t))throw new Error("Adding unlike terms");const s=this.c+t.c,i=this.vs;return new S(s,i)}initStr(t){const e=t.match(/^-?\d*/)[0],s=""===e?1:"-"===e?-1:parseInt(e);let i=t.match(/([a-zA-Z])(\^\d+)?/g);i||(i=[]);for(let t=0;t<i.length;t++){const e=i[t].split("^");e[1]=e[1]?parseInt(e[1]):1,i[t]=e}i=i.filter(t=>0!==t[1]),this.c=s,this.vs=new Map(i)}static var(t){const e=new Map([[t,1]]);return new S(1,e)}}class B{constructor(t){Array.isArray(t)&&t[0]instanceof S?(t.map(t=>t.clone()),this.terms=t):isNaN(t)?"string"==typeof t&&this.initStr(t):this.initNum(t)}initStr(t){t=(t=(t=t.replace(/\+-/g,"-")).replace(/-/g,"+-")).replace(/\s/g,""),this.terms=t.split("+").map(t=>new S(t)).filter(t=>0!==t.c)}initNum(t){this.terms=[new S(t)]}toLatex(){let t="";for(let e=0;e<this.terms.length;e++)e>0&&this.terms[e].c>=0&&(t+="+"),t+=this.terms[e].toLatex();return t}toString(){return this.toLaTeX()}clone(){const t=this.terms.map(t=>t.clone());return new B(t)}simplify(){const t=this.terms.slice();let e=[];for(let s=0;s<t.length;s++){if(!t[s])continue;let i=t[s];for(let e=s+1;e<t.length;e++)t[e]&&t[e].like(t[s])&&(i=i.add(t[e]),t[e]=null);e.push(i),t[s]=null}return e=e.filter(t=>0!==t.c),new B(e)}add(t,e){t instanceof B||(t=new B(t)),void 0===e&&(e=!0);const s=this.terms.concat(t.terms);let i=new B(s);return e&&(i=i.simplify()),i}mul(t,e){t instanceof B||(t=new B(t));const s=[];void 0===e&&(e=!0);for(let e=0;e<this.terms.length;e++)for(let i=0;i<t.terms.length;i++)s.push(this.terms[e].mul(t.terms[i]));let i=new B(s);return e&&(i=i.simplify()),i}pow(t,e){let s=this;for(let e=1;e<t;e++)s=s.mul(this);return e&&(s=s.simplify()),s}static var(t){const e=[S.var(t)];return new B(e)}static x(){return B.var("x")}static const(t){return new B(t)}}class E extends w{constructor(t){super(t),this.data=new O(this.settings),this.view=new q(this.data,this.settings)}static get commandWord(){return"Complete the arithmagon:"}}E.optionsSpec=[{title:"Vertices",id:"n",type:"int",min:3,max:20,default:3},{title:"Type",id:"type",type:"select-exclusive",selectOptions:[{title:"Integer (+)",id:"integer-add"},{title:"Integer (×)",id:"integer-multiply"},{title:"Fraction (+)",id:"fraction-add"},{title:"Fraction (×)",id:"fraction-multiply"},{title:"Algebra (+)",id:"algebra-add"},{title:"Algebra (×)",id:"algebra-multiply"}],default:"integer-add",vertical:!0},{title:"Puzzle type",type:"select-exclusive",id:"puz_diff",selectOptions:[{title:"Missing edges",id:"1"},{title:"Mixed",id:"2"},{title:"Missing vertices",id:"3"}],default:"1"}];class O{constructor(t){switch(this.settings=Object.assign({},{n:3,min:-20,max:20,num_diff:1,puz_diff:1,type:"integer-add"},this.settings,t),this.settings.num_diff=this.settings.difficulty,this.settings.puz_diff=parseInt(this.settings.puz_diff),//! ? This should have been done upstream...
this.n=this.settings.n,this.vertices=[],this.sides=[],this.settings.type.endsWith("add")?(this.opname="+",this.op=(t,e)=>t.add(e)):this.settings.type.endsWith("multiply")&&(this.opname="×",this.op=(t,e)=>t.mul(e)),this.settings.type){case"integer-add":case"integer-multiply":this.initInteger(this.settings);break;case"fraction-add":this.initFractionAdd(this.settings);break;case"fraction-multiply":this.initFractionMultiply(this.settings);break;case"algebra-add":this.initAlgebraAdd(this.settings);break;case"algebra-multiply":this.initAlgebraMultiply(this.settings);break;default:throw new Error("Unexpected switch default")}this.calculateEdges(),this.hideLabels(this.settings.puz_diff)}initInteger(t){for(let e=0;e<this.n;e++)this.vertices[e]={val:new M(r(t.min,t.max,e=>t.type.endsWith("add")||0!==e)),hidden:!1}}initFractionAdd(t){const e=t.num_diff;if(e<3){const t=l([5,7,9,11,13,17]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val.n:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val.n:void 0,o=r(1,2===e?t-1:n?t-Math.max(n,i):i?t-i:t-1,e=>!(1!==d(e,t)||i&&1!==d(e+i,t)&&e+i!==t||n&&1!==d(e+n,t)&&e+n!==t));this.vertices[s]={val:new M(o,t),hidden:!1}}}else{const t=l(e<7?[2,3,5]:[2,3,4,5,6,7,8,9,10,11]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val:void 0,o=e<7?4:8,a=s%2==1||e>4?r(2,o,e=>!(i&&e===i.d/t||n&&e===n.d/t)):1,l=t*a;let h;h=e<6?r(1,l-1,t=>1===d(t,l)&&(e>=4||!i||i.add(t,l)<=1)&&(e>=4||!n||n.add(t,l)<=1)):e<8?r(l+1,6*l,t=>1===d(t,l)):r(10*l,100*l,t=>1===d(t,l)),this.vertices[s]={val:new M(h,l),hidden:!1}}}}initFractionMultiply(t){for(let t=0;t<this.n;t++){const e=a(2,10),s=a(1,e-1);this.vertices[t]={val:new M(s,e),hidden:!1}}}initAlgebraAdd(t){switch(t.num_diff){case 1:{const t=String.fromCharCode(a(97,122));for(let e=0;e<this.n;e++){const s=a(1,10).toString();this.vertices[e]={val:new B(s+t),hidden:!1}}}break;case 2:default:if(Math.random()<.5){const t=String.fromCharCode(a(97,122));for(let e=0;e<this.n;e++){const s=a(1,10).toString(),i=a(1,10).toString();this.vertices[e]={val:new B(s+t+"+"+i),hidden:!1}}}else{const t=String.fromCharCode(a(97,122));let e=t;for(;e===t;)e=String.fromCharCode(a(97,122));for(let s=0;s<this.n;s++){const i=a(1,10).toString(),n=a(1,10).toString();this.vertices[s]={val:new B(i+t+"+"+n+e),hidden:!1}}}}}initAlgebraMultiply(t){const e=t.num_diff;switch(e){case 1:{const t=String.fromCharCode(a(97,122));for(let e=0;e<this.n;e++){const s=a(1,10).toString(),i=e%2==0?s:s+t;this.vertices[e]={val:new B(i),hidden:!1}}break}case 2:{const t=String.fromCharCode(a(97,122)),e=String.fromCharCode(a(97,122));for(let s=0;s<this.n;s++){const i=a(1,10).toString(),n=l([t,e]);this.vertices[s]={val:new B(i+n),hidden:!1}}break}case 3:{const t=String.fromCharCode(a(97,122));for(let e=0;e<this.n;e++){const s=a(1,10).toString(),i=a(1,3).toString();this.vertices[e]={val:new B(s+t+"^"+i),hidden:!1}}break}case 4:{const t=a(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1),i=String.fromCharCode(t+2);for(let t=0;t<this.n;t++){const n=a(1,10).toString()+e+("^"+a(0,3).toString())+s+("^"+a(0,3).toString())+i+("^"+a(0,3).toString());this.vertices[t]={val:new B(n),hidden:!1}}break}case 5:case 6:{const t=String.fromCharCode(a(97,122));for(let s=0;s<this.n;s++){const i=a(1,10).toString(),n=a(-9,9).toString();let o=i;6!==e&&s%2!=1||(o+=t),s%2==1&&(o+="+"+n),this.vertices[s]={val:new B(o),hidden:!1}}break}case 7:{const t=a(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1);for(let t=0;t<this.n;t++){let i=a(1,10).toString()+e+("^"+a(0,3).toString())+s+("^"+a(0,3).toString());if(t%2==1){i+="+"+a(-9,9).toString()+e+("^"+a(0,3).toString())+s+("^"+a(0,3).toString())}this.vertices[t]={val:new B(i),hidden:!1}}break}case 8:default:{const t=String.fromCharCode(a(97,122));for(let e=0;e<this.n;e++){const s=a(-9,9).toString();this.vertices[e]={val:new B(t+"+"+s),hidden:!1}}}}}calculateEdges(){for(let t=0;t<this.n;t++)this.sides[t]={val:this.op(this.vertices[t].val,this.vertices[(t+1)%this.n].val),hidden:!1}}hideLabels(t){switch(t){case 1:this.sides.forEach(t=>{t.hidden=!0});break;case 2:{this.sides.forEach(t=>{t.hidden=!0});const t=a(0,this.n-1,Math.random),e=Math.random()<.5?t:(t+1)%this.n;this.sides[t].hidden=!1,this.vertices[e].hidden=!0;break}case 3:this.vertices.forEach(t=>{t.hidden=!0});break;default:throw new Error("no_difficulty")}}}class q extends x{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=.35*Math.min(s,i),o=this.data.n;this.operationPoint=new y(0,0),this.vertexPoints=[];for(let t=0;t<o;t++){const e=t*Math.PI*2/o-Math.PI/2;this.vertexPoints[t]=y.fromPolar(n,e)}this.sidePoints=[];for(let t=0;t<o;t++)this.sidePoints[t]=y.mean(this.vertexPoints[t],this.vertexPoints[(t+1)%o]);this.allPoints=[this.operationPoint].concat(this.vertexPoints).concat(this.sidePoints),this.reCenter(),this.makeLabels(!0)}reCenter(){const t=y.min(this.allPoints),e=y.max(this.allPoints),s=y.mean(t,e);this.allPoints.forEach(t=>{t.translate(this.width/2-s.x,this.height/2-s.y)})}makeLabels(){this.data.vertices.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.vertexPoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal vertex",stylea:t.hidden?"answer vertex":"normal vertex"})}),this.data.sides.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.sidePoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal side",stylea:t.hidden?"answer side":"normal side"})}),this.labels.push({pos:this.operationPoint,textq:this.data.opname,texta:this.data.opname,styleq:"normal",stylea:"normal"}),this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq})}render(){const t=this.canvas.getContext("2d"),e=this.data.n;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath();for(let s=0;s<e;s++){const i=this.vertexPoints[s],n=this.vertexPoints[(s+1)%e];t.moveTo(i.x,i.y),t.lineTo(n.x,n.y)}t.stroke(),t.closePath(),this.renderLabels(!0)}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!0),this.answered=!0}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!0),this.answered=!1}}class k extends m{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a",test1:["foo"],test2:!0},t);let s;this.label=e.label,s=0===e.test1.length?"none":l(e.test1),this.questionLaTeX="d: "+e.difficulty+"\\\\ test1: "+s,this.answerLaTeX="test2: "+e.test2,this.render()}static get commandWord(){return"Test command word"}}k.optionsSpec=[{title:"Test option 1",id:"test1",type:"select-inclusive",selectOptions:["foo","bar","wizz"],default:[]},{title:"Test option 2",id:"test2",type:"bool",default:!0}];class N extends m{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label;const s=String(a(1,9))+String(a(0,9))+"."+String(a(0,9)),i=s+"0";this.questionLaTeX=s+"\\times 10",this.answerLaTeX="= "+i,this.render()}static get commandWord(){return"Evaluate"}}N.optionsSpec=[];class A extends x{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=this.radius=Math.min(s,i)/2.5;this.O=new y(0,0),this.A=new y(n,0),this.C=[];let o=0;for(let t=0;t<this.data.angles.length;t++)o+=this.data.angles[t]*Math.PI/180,this.C[t]=y.fromPolar(n,o);o=0;for(let t=0;t<this.data.angles.length;t++){const e=this.data.angles[t];this.labels[t]={pos:y.fromPolarDeg(n*(.4+6/e),o+e/2),textq:this.data.missing[t]?"x^\\circ":this.data.angles[t].toString()+"^\\circ",styleq:"normal"},this.data.missing[t]?(this.labels[t].texta=this.data.angles[t].toString()+"^\\circ",this.labels[t].stylea="answer"):(this.labels[t].texta=this.labels[t].textq,this.labels[t].stylea=this.labels[t].styleq),o+=e}this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate(),this.translate(s/2-this.O.x,i/2-this.O.y)}render(){const t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.O.x,this.O.y),t.lineTo(this.A.x,this.A.y);for(let e=0;e<this.C.length;e++)t.moveTo(this.O.x,this.O.y),t.lineTo(this.C[e].x,this.C[e].y);t.strokeStyle="gray",t.stroke(),t.closePath(),t.beginPath();let e=this.rotation;for(let s=0;s<this.data.angles.length;s++){const i=this.data.angles[s]*Math.PI/180;t.arc(this.O.x,this.O.y,this.radius*(.2+.07/i),e,e+i),t.stroke(),e+=i}t.closePath(),this.renderLabels(!1)}get allpoints(){let t=[this.A,this.O];return t=t.concat(this.C),this.labels.forEach((function(e){t.push(e.pos)})),t}}class T{constructor(t,e,s){if(e===[]||void 0===e)throw new Error("Must give angles");if(Math.round(e.reduce((t,e)=>t+e))!==t)throw new Error("Angle sum must be "+t);this.angles=e,this.missing=s,this.angleSum=t}static random(t){return T.randomSimple(t)}static randomSimple(t){const e=Object.assign({},{minAngle:10,minN:2,maxN:4},t);if(!e.angleSum)throw new Error("No angle sum given");const s=e.angleSum,i=e.n?e.n:a(e.minN,e.maxN),n=e.minAngle;if(i<2)throw new Error("Can't have missing fewer than 2 angles");const o=[];let r=s;for(let t=0;t<i-1;t++){const e=a(n,r-n*(i-t-1));r-=e,o.push(e)}o[i-1]=r;const l=[];return l.length=i,l.fill(!1),l[a(0,i-1)]=!0,new T(s,o,l)}initAllEqual(t){}randomRepeated(t){const e=this.settings.angleSum,s=this.settings.minAngle,i=t.n||a(t.minN,t.maxN),n=t.nMissing||Math.random()<.1?i:a(2,i-1);if(i<2||n<1||n>i)throw new Error(`Invalid arguments: n=${i}, m=${n}`);if(i===n){const t=[];t.length=i,t.fill(e/i);const s=[];return s.length=i,s.fill(!0),new T(e,t,s)}const o=[],r=[];r.length=i,r.fill(!1);const l=a(s,(e-s*(i-n))/n),h=[];let d=e-l*n;for(let t=0;t<i-n-1;t++){const e=a(s,d-s*(i-n-t-1));d-=e,h.push(e)}h[i-n-1]=d;{let t=0;for(;t<n;){const e=a(0,i-1);!1===r[e]&&(r[e]=!0,o[e]=l,t++)}}{let t=0;for(let e=0;e<i;e++)!1===r[e]&&(o[e]=h[t],t++)}return new T(e,o,r)}}class P extends w{constructor(t,e,s){super(s),this.data=t,this.view=e}static random(t){t=Object.assign({},{angleSum:180,minAngle:10,minN:2,maxN:4},t);const e=T.random(t),s=new A(e,t);return new P(e,s)}static get commandWord(){return"Find the missing value"}}class _ extends x{constructor(t,e){super(t,e);const s=this.width,i=this.height;this.A=new y(0,0),this.B=y.fromPolarDeg(1,t.angles[0]),this.C=new y(h(this.data.angles[1])/h(this.data.angles[2]),0);const n=y.inCenter(this.A,this.B,this.C);for(let t=0;t<3;t++){const e=[this.A,this.B,this.C][t];this.labels[t]={pos:y.mean(e,e,n),textq:this.data.missing[t]?"x^\\circ":this.data.angles[t].toString()+"^\\circ",styleq:"normal"},this.data.missing[t]?(this.labels[t].texta=this.data.angles[t].toString()+"^\\circ",this.labels[t].stylea="answer"):(this.labels[t].texta=this.labels[t].textq,this.labels[t].stylea=this.labels[t].styleq)}this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate();let o=y.min([this.A,this.B,this.C]),a=y.max([this.A,this.B,this.C]);const r=a.x-o.x,l=a.y-o.y;this.scale(Math.min((s-0)/r,(i-0)/l)),o=y.min([this.A,this.B,this.C]),a=y.max([this.A,this.B,this.C]);const d=y.mean(o,a);this.translate(s/2-d.x,i/2-d.y)}render(){const t=this.canvas.getContext("2d"),e=[this.A,this.B,this.C],s=this.data.apex;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.A.x,this.A.y);for(let i=0;i<3;i++){const n=e[i],o=e[(i+1)%3];s===i||s===(i+1)%3?u(t,n.x,n.y,o.x,o.y):t.lineTo(o.x,o.y)}t.strokeStyle="gray",t.stroke(),t.closePath(),this.renderLabels(!1)}get allpoints(){const t=[this.A,this.B,this.C];return this.labels.forEach(e=>{t.push(e.pos)}),t}}class F extends w{constructor(t,e,s){super(s),this.data=t,this.view=e}static random(t){t=Object.assign({},{angleSum:180,minAngle:25,minN:3,maxN:3},t);const e=T.random(t),s=new _(e,t);return new F(e,s,t)}static get commandWord(){return"Find the missing value"}}const W=[{id:"algebraic-fraction",title:"Simplify algebraic fractions",class:class extends m{constructor(t){super(t);const e=Object.assign({},{difficulty:2},t);var s,i,n,o,r,l,h,d,c,u,p,f,m;switch(e.difficulty){case 1:u=1,p=1,f=1,m=6;break;case 2:u=1,p=1,f=-6,m=6;break;case 3:u=1,p=3,f=-5,m=5;break;case 4:default:u=-3,p=3,f=-5,m=5}for(;!s&&!i||!n&&!o||!r&&!l||g(s,i,n,o);)s=a(u,p),n=a(u,p),r=a(u,p),i=a(f,m),o=a(f,m),l=a(f,m);n<=0&&o<=0&&(n=-n,o=-o,s=-s,i=-i),h=n*r,d=n*l+o*r,c=o*l;const y=`\\frac{${v(s*r,s*l+i*r,i*l)}}{${v(h,d,c)}}`;e.useCommandWord?this.questionLaTeX="\\text{Simplify} "+y:this.questionLaTeX=y,this.answerLaTeX=0===n&&1===o?v(0,s,i):`\\frac{${v(0,s,i)}}{${v(0,n,o)}}`,this.answerLaTeX="= "+this.answerLaTeX}static get commandWord(){return"Simplify"}}},{id:"add-a-zero",title:"Multiply by 10 (honest!)",class:N},{id:"integer-add",title:"Add integers (v simple)",class:class extends m{constructor(t){super(t);const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label;const s=a(10,1e3),i=a(10,1e3),n=s+i;this.questionLaTeX=s+" + "+i,this.answerLaTeX="= "+n,this.render()}static get commandWord(){return"Evaluate"}}},{id:"missing-angles",title:"Missing angles",class:class{constructor(t){if(!t.types||!Array.isArray(t.types)||0===t.types.length)throw new Error("Unsupported types list "+t.types);const e=l(t.types);this.init(e)}init(t,e){switch(t){case"aosl":{const t={angleSum:180};this.question=P.random(t);break}case"aaap":{const t={angleSum:360};this.question=P.random(t);break}case"triangle":this.question=F.random({});break;default:throw new Error("Unknown type "+t)}}initDifficulty(t,e){}getDOM(){return this.question.getDOM()}render(){return this.question.render()}showAnswer(){return this.question.showAnswer()}hideAnswer(){return this.question.hideAnswer()}toggleAnswer(){return this.question.toggleAnswer()}static get optionsSpec(){return[{title:"",id:"types",type:"select-inclusive",selectOptions:[{title:"On a straight line",id:"aosl"},{title:"Around a point",id:"aaap"},{title:"Triangle",id:"triangle"}],default:["aosl","aaap","triangle"],vertical:!0}]}static get commandWord(){return"Find the missing value"}}},{id:"equation-of-line",title:"Equation of a line (from two points)",class:class extends m{constructor(t){super(t);const e=Object.assign({},{difficulty:2},t),s=Math.ceil(e.difficulty/2);let i,n,o,r,l,h,d,c,u,p;switch(s){case 1:case 2:case 3:if(d=s<3?1:-5,c=5,u=s<2?0:-10,p=10,i=a(d,5),n=a(u,10),o=s<3?a(0,10):a(-15,15),r=i*o+n,s<3)l=a(o+1,15);else for(l=o;l===o;)l=a(-15,15);h=i*l+n;break;case 4:default:{const t=a(1,5),e=a(-5,5);i=new M(e,t),o=new M(a(-10,10)),r=new M(a(-10,10)),n=new M(r).sub(i.mul(o)),l=o.add(a(1,5)*i.d),h=i.mul(l).add(n);break}}const f=0===i||i.equals&&i.equals(0)?"":1===i||i.equals&&i.equals(1)?"x":-1===i||i.equals&&i.equals(-1)?"-x":i.toLatex?i.toLatex()+"x":i+"x",m=0===n||n.equals&&n.equals(0)?"":n<0?" - "+(n.neg?n.neg().toLatex():-n):n.toLatex?" + "+n.toLatex():" + "+n;this.questionLaTeX="("+o+", "+r+")\\text{ and }("+l+", "+h+")",this.answerLaTeX="y = "+f+m}static get commandWord(){return"Find the equation of the line through"}}},{id:"arithmagon-add",title:"Arithmagons",class:E},{id:"test",title:"Test questions",class:k}];function I(t){for(let e=0;e<W.length;e++)if(W[e].id===t)return W[e].class;return null}var D=!1;function R(t){this.opts=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}({},{onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["overlay","button","escape"]},t),this.init()}function H(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}function z(){this.modal=document.createElement("div"),this.modal.classList.add("tingle-modal"),0!==this.opts.closeMethods.length&&-1!==this.opts.closeMethods.indexOf("overlay")||this.modal.classList.add("tingle-modal--noOverlayClose"),this.modal.style.display="none",this.opts.cssClass.forEach((function(t){"string"==typeof t&&this.modal.classList.add(t)}),this),-1!==this.opts.closeMethods.indexOf("button")&&(this.modalCloseBtn=document.createElement("button"),this.modalCloseBtn.type="button",this.modalCloseBtn.classList.add("tingle-modal__close"),this.modalCloseBtnIcon=document.createElement("span"),this.modalCloseBtnIcon.classList.add("tingle-modal__closeIcon"),this.modalCloseBtnIcon.innerHTML='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.3 9.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3L5 6.4l3.3 3.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L6.4 5l3.3-3.3c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0L5 3.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L3.6 5 .3 8.3c-.4.4-.4 1 0 1.4z" fill="#000" fill-rule="nonzero"/></svg>',this.modalCloseBtnLabel=document.createElement("span"),this.modalCloseBtnLabel.classList.add("tingle-modal__closeLabel"),this.modalCloseBtnLabel.innerHTML=this.opts.closeLabel,this.modalCloseBtn.appendChild(this.modalCloseBtnIcon),this.modalCloseBtn.appendChild(this.modalCloseBtnLabel)),this.modalBox=document.createElement("div"),this.modalBox.classList.add("tingle-modal-box"),this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("tingle-modal-box__content"),this.modalBox.appendChild(this.modalBoxContent),-1!==this.opts.closeMethods.indexOf("button")&&this.modal.appendChild(this.modalCloseBtn),this.modal.appendChild(this.modalBox)}function X(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("tingle-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter)}function j(){this._events={clickCloseBtn:this.close.bind(this),clickOverlay:$.bind(this),resize:this.checkOverflow.bind(this),keyboardNav:V.bind(this)},-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.addEventListener("click",this._events.clickCloseBtn),this.modal.addEventListener("mousedown",this._events.clickOverlay),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}function V(t){-1!==this.opts.closeMethods.indexOf("escape")&&27===t.which&&this.isOpen()&&this.close()}function $(t){var e=this.modal.offsetWidth-this.modal.clientWidth,s=t.clientX>=this.modal.offsetWidth-15,i=this.modal.scrollHeight!==this.modal.offsetHeight;"MacIntel"===navigator.platform&&0===e&&s&&i||-1!==this.opts.closeMethods.indexOf("overlay")&&!function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"tingle-modal")&&t.clientX<this.modal.clientWidth&&this.close()}function U(){-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}R.prototype.init=function(){if(!this.modal)return z.call(this),j.call(this),document.body.appendChild(this.modal,document.body.firstChild),this.opts.footer&&this.addFooter(),this},R.prototype._busy=function(t){D=t},R.prototype._isBusy=function(){return D},R.prototype.destroy=function(){null!==this.modal&&(this.isOpen()&&this.close(!0),U.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},R.prototype.isOpen=function(){return!!this.modal.classList.contains("tingle-modal--visible")},R.prototype.open=function(){if(!this._isBusy()){this._busy(!0);var t=this;return"function"==typeof t.opts.beforeOpen&&t.opts.beforeOpen(),this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),this._scrollPosition=window.pageYOffset,document.body.classList.add("tingle-enabled"),document.body.style.top=-this._scrollPosition+"px",this.setStickyFooter(this.opts.stickyFooter),this.modal.classList.add("tingle-modal--visible"),"function"==typeof t.opts.onOpen&&t.opts.onOpen.call(t),t._busy(!1),this.checkOverflow(),this}},R.prototype.close=function(t){if(!this._isBusy()){if(this._busy(!0),"function"==typeof this.opts.beforeClose)if(!this.opts.beforeClose.call(this))return void this._busy(!1);document.body.classList.remove("tingle-enabled"),document.body.style.top=null,window.scrollTo({top:this._scrollPosition,behavior:"instant"}),this.modal.classList.remove("tingle-modal--visible");var e=this;e.modal.style.display="none","function"==typeof e.opts.onClose&&e.opts.onClose.call(this),e._busy(!1)}},R.prototype.setContent=function(t){return"string"==typeof t?this.modalBoxContent.innerHTML=t:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(t)),this.isOpen()&&this.checkOverflow(),this},R.prototype.getContent=function(){return this.modalBoxContent},R.prototype.addFooter=function(){return X.call(this),this},R.prototype.setFooterContent=function(t){return this.modalBoxFooter.innerHTML=t,this},R.prototype.getFooterContent=function(){return this.modalBoxFooter},R.prototype.setStickyFooter=function(t){return this.isOverflow()||(t=!1),t?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("tingle-modal-box__footer--sticky"),H.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("tingle-modal-box__footer--sticky"))),this},R.prototype.addFooterBtn=function(t,e,s){var i=document.createElement("button");return i.innerHTML=t,i.addEventListener("click",s),"string"==typeof e&&e.length&&e.split(" ").forEach((function(t){i.classList.add(t)})),this.modalBoxFooter.appendChild(i),i},R.prototype.resize=function(){console.warn("Resize is deprecated and will be removed in version 1.0")},R.prototype.isOverflow=function(){var t=window.innerHeight;return this.modalBox.clientHeight>=t},R.prototype.checkOverflow=function(){this.modal.classList.contains("tingle-modal--visible")&&(this.isOverflow()?this.modal.classList.add("tingle-modal--overflow"):this.modal.classList.remove("tingle-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(H.call(this),this.setStickyFooter(!0)))},c("div","overlay hidden",document.body).addEventListener("click",K);class Z{constructor(t){this.questions=[],this.topics=[],this.optionsSets=[],this.qNumber=t||1,this.answered=!1,this.commandWord="",this.useCommandWord=!0,this.n=8,this._build()}_build(){this.outerBox=c("div","question-outerbox"),this.headerBox=c("div","question-headerbox",this.outerBox),this.displayBox=c("div","question-displaybox",this.outerBox),this._buildOptionsBox(),this._buildTopicChooser()}_buildOptionsBox(){const t=c("span",null,this.headerBox);this.topicChooserButton=c("span","topic-chooser button",t),this.topicChooserButton.innerHTML="Choose topic",this.topicChooserButton.addEventListener("click",()=>this.chooseTopics());const e=c("span",null,this.headerBox);e.append("Difficulty: ");const s=c("span","slider-outer",e);this.difficultySliderElement=c("input",null,s);const i=c("span",null,this.headerBox);i.append("Number of questions: ");const n=c("input","n-questions",i);n.type="number",n.min="1",n.value="8",n.addEventListener("change",()=>{this.n=parseInt(n.value)}),this.generateButton=c("button","generate-button button",this.headerBox),this.generateButton.disabled=!0,this.generateButton.innerHTML="Generate!",this.generateButton.addEventListener("click",()=>this.generateAll())}_initSlider(){this.difficultySlider=new t({target:this.difficultySliderElement,values:{min:1,max:10},range:!0,set:[2,6],step:1,tooltip:!1,scale:!0,labels:!0})}_buildTopicChooser(){const t=W.map(t=>({id:t.id,title:t.title})),e=[];t.forEach(t=>{e.push({title:t.title,id:t.id,type:"bool",default:!1,swapLabel:!0})}),this.topicsOptions=new p(e),this.topicsModal=new R({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close",onClose:()=>{this.updateTopics()}}),this.topicsModal.addFooterBtn("OK","button modal-button",()=>{this.topicsModal.close()}),this.topicsOptions.renderIn(this.topicsModal.modalBoxContent);Array.from(this.topicsModal.modalBoxContent.getElementsByTagName("li")).forEach(t=>{const e=t.dataset.optionId;if(I(s=e).optionsSpec&&I(s).optionsSpec.length>0){const e=c("div","icon-button extra-options-button",t);this._buildTopicOptions(t.dataset.optionId,e)}var s})}_buildTopicOptions(t,e){const s=function(t){const e=I(t).optionsSpec||[];return new p(e)}(t);this.optionsSets[t]=s;const i=new R({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close"});i.addFooterBtn("OK","button modal-button",()=>{i.close()}),s.renderIn(i.modalBoxContent),e.addEventListener("click",()=>{i.open()})}chooseTopics(){this.topicsModal.open()}updateTopics(){const t=function(t){const e=[];for(const s in t)t[s]&&e.push(s);return e}(this.topicsOptions.options);let e;if(this.topics=t,0===t.length)e="Choose topic",this.generateButton.disabled=!0;else{e=function(t){return W.find(e=>e.id===t).title}(t[0]),this.generateButton.disabled=!1}t.length>1&&(e+=" +"+(t.length-1)),this.topicChooserButton.innerHTML=e}setCommandWord(){let t=I(this.topics[0]).commandWord,e=!0;for(let s=1;s<this.topics.length;s++)if(I(this.topics[s]).commandWord!==t){t="",e=!1;break}this.commandWord=t,this.useCommandWord=e}generateAll(){this.displayBox.innerHTML="",this.questions=[],this.setCommandWord();c("p","katex mainq",this.displayBox).innerHTML=`${this.qNumber}. ${this.commandWord}`,this.answerButton=c("p","button show-answers",this.displayBox),this.answerButton.addEventListener("click",()=>{this.toggleAnswers()}),this.answerButton.innerHTML="Show answers";const t=this.difficultySlider.getValueL(),e=this.difficultySlider.getValueR();for(let s=0;s<this.n;s++){const i=c("div","question-container",this.displayBox);i.dataset.question_index=s,this.questions[s]||(this.questions[s]={}),this.questions[s].container=i;const n=t+Math.floor(s*(e-t+1)/this.n);this.generate(s,n)}}generate(t,s,i){i=i||l(this.topics);const n={label:"",difficulty:s,useCommandWord:!1};this.optionsSets[i]&&Object.assign(n,this.optionsSets[i].options);const o=function(t,e){return new(I(t))(e)}(i,n);if(!this.questions[t])throw new Error("question not made");this.questions[t].question=o,this.questions[t].topicId=i;const a=this.questions[t].container;a.innerHTML="";let r=function(t){return t<26?String.fromCharCode(97+t):t<52?String.fromCharCode(65+t-26):String.fromCharCode(945+t-52)}(t)+")";this.useCommandWord?a.classList.remove("individual-command-word"):(r+=" "+I(i).commandWord,a.classList.add("individual-command-word"));c("div","question-number katex",a).innerHTML=r,a.appendChild(o.getDOM()),o.render();const h=c("div","question-actions hidden",a),d=c("div","question-refresh icon-button",h);c("div","question-answer icon-button",h).addEventListener("click",()=>{o.toggleAnswer(),K()}),d.addEventListener("click",()=>{this.generate(t,s),K()}),a.addEventListener("click",()=>{(function(t,e){let s=!1;for(;t&&t!==document;t=t.parentNode)t.classList.contains(e)&&(s=!0);return s})(e.target,"question-actions")||this.showQuestionActions(e,t)})}toggleAnswers(){this.answered?this.questions.forEach(t=>{t.question.hideAnswer(),this.answered=!1,this.answerButton.innerHTML="Show answers"}):this.questions.forEach(t=>{t.question.showAnswer(),this.answered=!0,this.answerButton.innerHTML="Hide answers"})}showQuestionActions(t,e){K();const s=this.questions[e].container,i=s.querySelector(".question-actions");document.querySelector(".overlay").classList.remove("hidden"),i.classList.remove("hidden"),i.style.left=s.offsetWidth/2-i.offsetWidth/2+"px",i.style.top=s.offsetHeight/2-i.offsetHeight/2+"px"}appendTo(t){t.appendChild(this.outerBox),this._initSlider()}appendBefore(t,e){t.insertBefore(this.outerBox,e),this._initSlider()}}function K(t){document.querySelectorAll(".question-actions").forEach(t=>{t.classList.add("hidden")}),document.querySelector(".overlay").classList.add("hidden")}document.addEventListener("DOMContentLoaded",()=>{(new Z).appendTo(document.body)})}();
